import{u as V,y as W,p as i,v as X,t as x,s,a2 as Y,D as P}from"./index-d3b20173.js";import{a as Z,s as ee,b as se}from"./mock-15c2f996.js";import{c as te,a as oe}from"./practice-b07ec58d.js";import{b as ae}from"./icon-back-h-0fef6b27.js";import{c as ne,n as ce}from"./icon-collect-n-7dad1c8c.js";import{C as re,S as le,I as ie,Q as ue,J as de,a as _e}from"./index-3deca731.js";import"./index-e9655fcb.js";import"./index-7f0749c1.js";import"./useForceUpdate-5b968ce5.js";const pe="_navheader_b5dca_1",me="_top_b5dca_9",fe="_score_b5dca_39",he="_button_b5dca_65",be="_num_b5dca_99",ge="_item_b5dca_234",a={navheader:pe,top:me,"top-left":"_top-left_b5dca_22","icon-back":"_icon-back_b5dca_28","top-right":"_top-right_b5dca_34",score:fe,"score-info":"_score-info_b5dca_49","remaining-time":"_remaining-time_b5dca_57",button:he,"paper-box":"_paper-box_b5dca_79","fix-left-box":"_fix-left-box_b5dca_88","number-box":"_number-box_b5dca_99","active-num":"_active-num_b5dca_108","act-num":"_act-num_b5dca_125","no-num":"_no-num_b5dca_142","error-num":"_error-num_b5dca_159","correct-num":"_correct-num_b5dca_176",num:be,"right-box":"_right-box_b5dca_209","title-box":"_title-box_b5dca_216","questions-box":"_questions-box_b5dca_229",item:ge,"collect-icon":"_collect-icon_b5dca_243"};var g=null;const Be=()=>{const q=V(),w=new URLSearchParams(W().search);i.useState(!1);const[c,E]=i.useState({}),[v,M]=i.useState({}),[d,A]=i.useState([]),[I,_]=i.useState({}),[j,y]=i.useState({}),[C,O]=i.useState(0),[Q,f]=i.useState(!1),[xe,R]=i.useState(0),[N,F]=i.useState({day:0,hr:0,min:0,sec:0}),[B,S]=i.useState(!1),[L,ve]=i.useState(Number(w.get("id"))||0),[p,je]=i.useState(Number(w.get("pid"))||0);X(e=>e.systemConfig.value.configFunc),i.useEffect(()=>(D(),()=>{g&&clearInterval(g)}),[L,p]);const D=()=>{Z(p).then(e=>{document.title=e.data.paper.title,M(e.data.paper),E(e.data.record);let t=e.data.questions;if(t.length===0){x.error("未获取到试题"),q("/exam/mockpaper");return}let n=0,o={};t.forEach(u=>{u.answer_content?o[u.question_id]=!0:n++}),_(o),A(t),O(n);let l=new Date(e.data.record.expired_at.replace(/-/g,"/"));const r=Math.floor(Date.parse(l));R(r),e.data.record.status===0?J(r):e.data.record.status===1&&U(t)})},U=e=>{let t=e,n=[];for(let o=0;o<t.length;o++)n.push(t[o].question_id);te({question_ids:n}).then(o=>{y(o.data)})},J=e=>{const t=new Date,n=Date.parse(t);let o=(e-n)/1e3;if(o<=0){k();return}g=setInterval(()=>{if(o>0){o--;let l=Math.floor(o/3600/24),r=Math.floor(o/3600%24),u=Math.floor(o/60%60),h=Math.floor(o%60);F({day:l,hr:r<10?"0"+r:r,min:u<10?"0"+u:u,sec:h<10?"0"+h:h})}else k()},1e3)},k=()=>{g&&clearInterval(g),H()},H=()=>{B||(S(!0),ee(p,{pid:c.id}).then(e=>{S(!1),e.data.status;let t=e.data.total_score;f(!1),x.success("考试结束，得分："+t),D()}).catch(e=>{S(!1)}))},$=()=>{c.status===1&&(z(),q(-1))},z=()=>{f(!1)},T=e=>{let t=document.getElementById(String(e));document.documentElement.scrollTop=t.offsetTop},G=()=>{f(!0)},K=e=>{let t={...j};oe({question_id:e}).then(()=>{t[e]===1?(x.success("已取消收藏"),t[e]=0,y(t)):(x.success("已收藏试题"),t[e]=1,y(t))})},m=(e,t,n)=>{let o={pid:p,answer:t,question_id:e};n&&(o={pid:p,images:n,answer:t,question_id:e}),se(p,o).then(l=>{let r=I;if(typeof e=="string"&&e.indexOf("-")!=-1)if(t==="")if(n&&n.length>0){let b=e.substring(0,e.indexOf("-"));r[b]=!0,_(r)}else{let b=e.substring(0,e.indexOf("-"));r[b]=!1,_(r)}else{let b=e.substring(0,e.indexOf("-"));r[b]=!0,_(r)}else t===""?n&&n.length>0?(r[e]=!0,_(r)):(r[e]=!1,_(r)):(r[e]=!0,_(r));let u=Object.keys(r).length,h=d.length-u;O(h)})};return s.jsxs("div",{className:"full-container",children:[Q?s.jsxs(Y,{title:"确认信息",centered:!0,forceRender:!0,maskClosable:!1,open:!0,width:500,onCancel:()=>f(!1),footer:null,children:[C!==0&&s.jsxs("div",{className:a.text,children:["还有",C,"道题未做，确认要交卷吗？"]}),C===0&&s.jsx("div",{className:a.text,children:"确认要交卷吗？"}),s.jsxs("div",{slot:"footer",style:{display:"flex",flexDirection:"row-reverse",marginTop:15},children:[s.jsx(P,{type:"primary",onClick:()=>k(),loading:B,children:"确定"}),s.jsx(P,{style:{marginRight:15},onClick:()=>f(!1),children:"继续答题"})]})]}):null,s.jsx("div",{className:a.navheader,children:s.jsxs("div",{className:a.top,children:[c&&c.status===0&&s.jsx("div",{className:a["top-left"],children:v.title}),c&&c.status===1&&s.jsxs("div",{className:a["top-left"],onClick:()=>$(),children:[s.jsx("img",{className:a["icon-back"],src:ae}),v.title]}),s.jsxs("div",{className:a["top-right"],children:[c&&c.status===1&&s.jsxs("div",{className:a.score,children:["考试得分：",s.jsxs("strong",{children:[c.get_score,"分"]})]}),c&&c.status===0&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:a["score-info"],children:["及格分：",v.pass_score,"分/",c.total_score,"分"]}),s.jsxs("div",{className:a["remaining-time"],children:["倒计时：",N.hr,"时",N.min,"分",N.sec,"秒"]}),s.jsx("div",{className:a.button,onClick:()=>G(),children:"立即交卷"})]})]})]})}),s.jsxs("div",{className:a["paper-box"],children:[s.jsxs("div",{className:a["fix-left-box"],children:[d.length>0&&c&&c.status===0&&s.jsx("div",{className:a["number-box"],children:d.map((e,t)=>s.jsx("div",{className:I[e.question_id]?a["active-num"]:a.num,onClick:()=>T(t),children:t+1},t))}),d.length>0&&c&&c.status===1&&s.jsx("div",{className:a["number-box"],children:d.map((e,t)=>s.jsx("div",{className:e.is_correct===1?a["correct-num"]:e.is_correct===0?a["error-num"]:e.is_correct===2?a["act-num"]:e.is_correct===3?a["no-num"]:a.num,onClick:()=>T(t),children:t+1},t))})]}),s.jsx("div",{className:a["right-box"],children:d.length>0&&c&&s.jsx("div",{className:a["questions-box"],children:d.map((e,t)=>s.jsxs("div",{className:a.item,id:String(t),children:[c.status===1&&s.jsxs("div",{className:a["collect-icon"],onClick:()=>K(e.question_id),children:[j[e.question_id]===1&&s.jsxs(s.Fragment,{children:[s.jsx("img",{src:ne}),s.jsx("strong",{children:"已收藏"})]}),j[e.question_id]!==1&&s.jsxs(s.Fragment,{children:[s.jsx("img",{src:ce}),"收藏试题"]})]}),e.question.type===1&&s.jsx(re,{num:t+1,question:e.question,reply:e.answer_content,score:e.score,isCorrect:e.is_correct,isOver:c.status===1,wrongBook:!1,update:(n,o,l)=>{m(n,o,l)}},e.question_id),e.question.type===2&&s.jsx(le,{num:t+1,question:e.question,reply:e.answer_contents_rows,score:e.score,isCorrect:e.is_correct,isOver:c.status===1,wrongBook:!1,update:(n,o,l)=>{m(n,o,l)}},e.question_id),e.question.type===3&&s.jsx(ie,{num:t+1,question:e.question,reply:e.answer_contents_rows,score:e.score,isCorrect:e.is_correct,isOver:c.status===1,wrongBook:!1,update:(n,o,l)=>{m(n,o,l)}},e.question_id),e.question.type===4&&s.jsx(ue,{num:t+1,question:e.question,reply:e.answer_content,thumbs:e.thumbs_rows,score:e.score,isCorrect:e.is_correct,isOver:c.status===1,showImage:!0,wrongBook:!1,update:(n,o,l)=>{m(n,o,l)}},e.question_id),e.question.type===5&&s.jsx(de,{num:t+1,question:e.question,reply:e.answer_contents_rows,score:e.score,isCorrect:e.is_correct,isOver:c.status===1,wrongBook:!1,update:(n,o,l)=>{m(n,o,l)}},e.question_id),e.question.type===6&&s.jsx(_e,{num:t+1,question:e.question,reply:e.answer_contents_rows,score:e.score,isCorrect:e.is_correct,isOver:c.status===1,showImage:!0,wrongBook:!1,update:(n,o,l)=>{m(n,o,l)}},e.question_id)]},t))})})]})]})};export{Be as default};
