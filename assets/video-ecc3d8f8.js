import{q as te,u as Ve,v as q,p as s,s as e,L as y,I as tt,D as st,S as H,E as at,t as E,M as we,y as Fe,J as it,K as Re,N as f,O as nt,F as ot,P as rt,Q as lt}from"./index-d3b20173.js";import{e as ct,v as dt,p as ut,f as mt,g as ht,d as vt}from"./course-6a8a6975.js";import{E as De}from"./index-ce951dff.js";import{H as pt}from"./index-7f88061e.js";import{U as Pe}from"./index-7f0749c1.js";import{l as je}from"./icon-lock-b2682a8d.js";import"./useForceUpdate-5b968ce5.js";function gt(){return te.get("/addons/Snapshot/api/v1/config",{})}function ft(i){return te.get("/addons/Snapshot/api/v1/resource/images",i)}function xt(i){return te.get("/addons/Snapshot/api/v1/resource/query",i)}function _t(i){return te.destroy(`/addons/Snapshot/api/v1/resource/image/${i}`)}function yt(i){return te.post("/addons/Snapshot/api/v1/upload/image",i)}const bt=({vid:i,isBuy:r,comments:c,commentUsers:l,fresh:m,success:p})=>{const h=Ve(),x=q(_=>_.loginUser.value.user),N=q(_=>_.loginUser.value.isLogin),[v,n]=s.useState(""),[d,T]=s.useState(!1),A=()=>{d||v!==""&&(T(!0),ct(i,{content:v}).then(()=>{E.success("成功"),n(""),T(!1),p()}).catch(_=>{T(!1)}))};return e.jsxs("div",{className:y["course-comments-box"],children:[e.jsx("div",{className:y["comment-divider"],children:"全部评论"}),e.jsx("div",{className:y.line}),!m&&N&&r&&e.jsx("div",{className:y.replybox,children:e.jsxs("div",{className:y.reply,children:[e.jsx("img",{className:y["user-avatar"],src:x.avatar}),e.jsx(tt,{value:v,onChange:_=>{n(_.target.value)},style:{width:960,height:48,marginRight:30,fontSize:16},placeholder:"此处填写你的评论"}),e.jsx(st,{type:"primary",disabled:v.length===0,style:{width:72,height:48,fontSize:16,border:"none"},onClick:()=>{A()},loading:d,children:"评论"})]})}),!m&&!N&&e.jsx("div",{className:y.replybox,children:e.jsx("div",{className:y.text,onClick:()=>h("/login"),children:"未登录，请登录后再评论"})}),m&&e.jsx("div",{style:{width:1140,display:"flex",flexDirection:"column"},children:Array.from({length:3}).map((_,b)=>e.jsxs("div",{style:{width:1140,height:48,marginBottom:30,display:"flex",flexDirection:"row"},children:[e.jsx(H.Avatar,{active:!0,size:48,style:{marginRight:30}}),e.jsxs("div",{style:{width:960,height:48,display:"flex",flexDirection:"column"},children:[e.jsx(H.Button,{active:!0,style:{width:960,height:14,marginTop:3,marginBottom:16}}),e.jsx(H.Button,{active:!0,style:{width:960,height:14}})]})]},b))}),e.jsxs("div",{className:y["comment-top"],children:[!m&&c.length===0&&e.jsx(De,{}),!m&&c.length>0&&c.map(_=>e.jsxs("div",{className:y["comment-item"],children:[e.jsx("div",{className:y["user-avatar"],children:e.jsx("img",{src:l[_.user_id].avatar})}),e.jsxs("div",{className:y["comment-content"],children:[e.jsxs("div",{className:y["comment-info"],children:[e.jsx("div",{className:y.nickname,children:l[_.user_id].nick_name}),e.jsx("div",{className:y["comment-time"],children:at(_.created_at)})]}),e.jsx("div",{className:y["comment-text"],dangerouslySetInnerHTML:{__html:_.render_content}})]})]},_.id))]})]})},wt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAMAAAC5zwKfAAAAAXNSR0IArs4c6QAAAUdQTFRFAAAA////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Oml7WgAAAGx0Uk5TAAECAwQGBwkMDQ8QERITFBUWFxgZGxwkJicqKy0uODs+QEFQUVJXYGFiZmhtbm9ydoCEhYmLjZCSl5iZmp6io6anqquws7S2t77Bxs7P0dPZ2t3h4uPk5ebn6ers7vDx8vP09fb4+fr7/P3+Xdm8YgAAAZtJREFUWMPt2MlTwjAUBvCAiAooIogL7igq7oLigvuGioorWBAUK7Lk/z+bHFLGmbTpK8Mt36nfZPq7tJ3OewjJtDMOn58bb4clzneoYp1UUiG458lgg+T7weAeNkwM6nWWjcE0FByid6klbirk6AMKjlNwgX+2T46+Jagb+8BoiGaWgot2bpL0efX1OMmlTcCNHX1hUBqFu42gvrdawRZSjOh5UWwttTDfC5Ytgjjv5oJxbDlrXPDROnjD85wN6+AnD/TiFtLNAd2tgC7eHySnKEoJbhXIbYruX2ZeexMmSY5ZO6Mty1qcth/WRgy/PQ18pW2LtR3anliL0qZKUIISlKAEJShBCUpQghKEgO+0JVjbpe2ZtRVSbFUg+Gsn7ZS1C3qmzZaJf2OSSRDPIOQqsqIOIjTRHD4DCC2Bwdz68n1zunmJbWabTTm5rJoEI/BJyhichoMB4x1fHeqpgmXiLRS8Eixa5qBgWLQJSsG8a+FqyZWGeBkTm86uZM20d+4xtf8a3n6oirH628GU+eWcrdcviM8h9/Ltyh81BXznWdm9egAAAABJRU5ErkJggg==",jt=({url:i,close:r,del:c})=>e.jsxs("div",{className:we["image-preview-shadow-box"],onClick:()=>r(),children:[e.jsx("img",{className:we.del,onClick:()=>c(),src:wt}),e.jsx("img",{className:we.img,src:i})]}),St="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAMAAAANIilAAAAAAXNSR0IArs4c6QAAAj1QTFRFAAAA////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////anIwUQAAAL50Uk5TAAECAwQFBgcICQoLDQ4REhQVFhcYGRobHB0eHyAhIiMkJSYnKCkqKywtLi8wMTIzNDU2Nzg5Ojs+P0BBQkNFR0hJTU5PUFFSVFVWV1haX2BhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h6fn+BhYeKjJCRkpSWl5manZ+ipKanqausrq+wsbS1ubq8vb7CxMbJyszOz9DR0tXW19jZ2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Lz9Pb3+Pn6+/z9/nHi+dsAAAJ9SURBVBgZ7cH3W41xHAbg56SFFLJHKmUnQlaEbBJZlUJGZjaRLTOEskcTOU6HjoZK7/O3uT5H6vuuU/zm0n2j139t4LDhI0aOHjM2YlxU9PiY2Amx/dBDfvudNGopCEGPXKSVR4HogWW0lovuOUppzdUf3VpFO3nojuM57bhD4JvfYdq7EAgz/7SiJ2W/1NKXL2VeJQUz8VtoCf+UdggdbtJS89Oiwst3qjRaWgevKbTw7VxSMLyGpBVrNHsBrwyafM8PgyL+Ps3CIPbTqHwSDLJbaTQOYh8N7oXBZKGbBpEQe6lXEgQLCU3Ui4TYQ52acFhar1EnCiKXqvZE2DhLnWiI3VQVwk6oh6rxELup0GJg6yhVMRC7qHgAexEaFbEQO6nYAx+eUTEBIoeKBPhwmoqJENlUhMCHLComQexglyZYWXxkAMQaKiZDZLGLB1Y8zIVIoWIKRCa7tMJCKJkJkUrFVIhMKobCbCmZDHGAimkQGVQsgdkNNgRDXKIiDmI7FcdgslLjKQiHk4rpENuoqHbAYEUj3YMgFlAVD7GVqhSogpKuamyZB69rVMVDbKGq1A+dUp0aybr58JreTtUMiM3UyUWnKyQbTgyCV+Bj6syESKdO6yL8NupQzpJgdDhPvQSIdOrVx8JCHg1mQWyiQX0yjPxP0mg2xEYa/TgYAJ1RxTSZA5FGs5ep/ugUnt9Is0SIDbTiOrs6KgAYMGPHrVZamQuxnLaa22grDmJwG/9CY194neFfOI5fgm/zj90NQgfH2uvPXr1+/ebN23fvyssrKiorq6qra2rev//w8WNt7adPTudnl6uuzu3+8vVrfb3HU/dwWx/0+of8BDtuZCaxffBfAAAAAElFTkSuQmCC";var L=null;const Nt=({id:i,resourceType:r,duration:c})=>{const l=s.useRef(null),m=s.useRef(null),p=s.useRef(null),h=s.useRef(0),x=Fe().pathname,[N,v]=s.useState(!1);s.useState(!1);const[n,d]=s.useState(!1),[T,A]=s.useState(!1),[_,b]=s.useState(!1),[oe,se]=s.useState(""),[re,le]=s.useState(0),[ae,K]=s.useState(0),[W,Z]=s.useState([]),[ie,M]=s.useState(!1),[ce,de]=s.useState(0),[B,ue]=s.useState({});s.useEffect(()=>(A(!1),d(!1),b(!1),ve(),ne(),A(!0),N&&(M(!0),R()),()=>{L&&clearInterval(L),G()}),[i,N]),s.useEffect(()=>{N&&(L&&clearInterval(L),M(!0),R())},[n]),s.useEffect(()=>{L&&clearInterval(L),G()},[x]);const ne=()=>{gt().then(a=>{ue(a.data);let o=a.data.status[r]===1;v(o)})},R=async()=>{if(window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia)try{const a=await window.navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user",width:290,height:164}});if(window.snapShortMediaStream=a,l.current){let o=l.current;o.srcObject=a,o.onloadedmetadata=()=>{o.play()}}if(m.current){let o=m.current;o.srcObject=a,o.onloadedmetadata=()=>{o.play()}}Se()}catch(a){console.log("err:"+a),M(!1),G()}},G=()=>{window.snapShortMediaStream&&(typeof window.snapShortMediaStream.stop=="function"?window.snapShortMediaStream.stop():window.snapShortMediaStream.getTracks()[0].stop())},Se=()=>{L=setInterval(me,B.cycle_time*1e3)},me=()=>{console.info("开始拍照啦...");let a=nt(0,100),o=h.current;a<=B.rate&&o<B.max_times&&(console.info("上传拍照中..."),he()),o>=B.max_times&&L&&clearInterval(L)},Q=()=>{ae!==0&&_t(ae).then(a=>{E.success("删除成功"),Y()})},he=async()=>{if(p.current){let a=p.current,o=m.current;a.getContext("2d").drawImage(o,0,0,1920,1440),a.toBlob(I=>{let P=new FormData;P.append("file",I),P.append("duration",String(c)),P.append("resource_id",String(i)),P.append("resource_type",r),yt(P).then(()=>{let J=h.current;J++,h.current=J,Y()}).catch(J=>{E.error(J.message||"上传错误")})})}},Y=()=>{ft({resource_id:i,resource_type:r}).then(a=>{a.data.data?Z(a.data.data):Z([])})},X=(a,o,I)=>{le(a),se(o),K(I),b(!0)},ve=()=>{xt({resource_type:r,resource_id:i}).then(a=>{de(a.data.count),h.current=a.data.count})},pe={name:"file",multiple:!1,method:"POST",action:it.app_url+"/addons/Snapshot/api/v1/upload/image?duration="+c+"&resource_id="+i+"&resource_type="+r,headers:{Accept:"application/json",authorization:"Bearer "+Re()},beforeUpload:a=>{const o=a.type==="image/png"||a.type==="image/jpg"||a.type==="image/jpeg";return o||E.error(`${a.name}不是图片文件`),o||Pe.LIST_IGNORE},onChange(a){const{status:o,response:I}=a.file;o==="done"?I.code===0?(E.success("上传成功"),Y()):E.error(I.msg):o==="error"&&E.error(`${a.file.name} 上传失败`)}};return e.jsx(e.Fragment,{children:N&&e.jsxs("div",{className:f["snapshot-box"],children:[_&&e.jsx(jt,{url:oe,close:()=>{le(0),b(!1)},del:()=>Q()}),!T&&e.jsx("div",{className:f.tabIcon,onClick:()=>{A(!0),N&&(M(!0),R())},children:e.jsx("img",{src:St})}),e.jsxs("div",{className:f["list-box"],style:{display:T?"block":"none"},children:[e.jsxs("div",{className:f["list-top"],children:[n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:f.left,children:"照片管理"}),e.jsx("div",{className:f.right,onClick:()=>{d(!1),b(!1)},children:"返回"})]}),!n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:f.left,children:"学习拍照"}),e.jsx("div",{className:f.right,onClick:()=>{A(!1),b(!1)},children:"最小化窗口"})]})]}),n&&e.jsx("div",{className:f["thumb-box"],children:W.length>0&&W.map((a,o)=>e.jsx("div",{className:re===o?f["thumb-active-item"]:f["thumb-item"],onClick:()=>{X(o,a.thumb,a.id)},children:a.thumb&&e.jsx("div",{className:f["image-view"],style:{backgroundImage:"url("+a.thumb+")"}})},o))}),e.jsxs("div",{style:{display:n?"none":"flex"},className:f["camera-box"],children:[e.jsxs("div",{className:f.content,id:"contentHolder",style:{display:ie?"flex":"none"},children:[e.jsxs("div",{style:{display:"none"},children:[e.jsx("canvas",{ref:p,width:"1920",height:"1440",id:"canvas"}),e.jsx("video",{width:1920,height:1440,autoPlay:!0,ref:m})]}),e.jsx("video",{width:290,height:164,autoPlay:!0,ref:l})]}),!ie&&e.jsx("span",{className:f.tip,children:"摄像头未捕捉到画面"})]}),n&&e.jsx(Pe,{...pe,showUploadList:!1,children:e.jsx("div",{className:f["upload-image-snapshot"],children:"手动上传学习照片"})}),!n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:f["camera-tip"],style:{marginTop:20},children:"系统自动随机拍照无需操作"}),e.jsx("div",{className:f["camera-tip"],children:"请保证摄像头开启对准面部"}),e.jsx("div",{className:f["upload-image-snapshot"],onClick:()=>{d(!0),Y()},children:"学习照片管理"})]})]})]})})},At="_goCurrent_i85w6_27",It="_link_i85w6_46",w={"course-info":"_course-info_i85w6_1","video-box":"_video-box_i85w6_7","play-box":"_play-box_i85w6_13","des-video":"_des-video_i85w6_18",goCurrent:At,link:It,"alert-message":"_alert-message_i85w6_51","subscribe-button":"_subscribe-button_i85w6_62","subscribe-button2":"_subscribe-button2_i85w6_75","subscribe-info":"_subscribe-info_i85w6_83","next-page":"_next-page_i85w6_87","last-video":"_last-video_i85w6_103","attach-list-box":"_attach-list-box_i85w6_110","attach-item":"_attach-item_i85w6_120","attach-name":"_attach-name_i85w6_132","download-attach":"_download-attach_i85w6_140"},Ct="_text_163rr_47",Tt="_text2_163rr_55",Ut="_free_163rr_72",F={"video-item":"_video-item_163rr_1","video-title":"_video-title_163rr_18","play-icon":"_play-icon_163rr_21","active-text":"_active-text_163rr_38",text:Ct,text2:Tt,"active-text2":"_active-text2_163rr_63",free:Ut,"video-duration":"_video-duration_163rr_85"},kt=({course:i,videos:r,video:c,isBuy:l,buyVideos:m,switchVideo:p})=>e.jsx(e.Fragment,{children:r.length>0&&r.map(h=>e.jsxs("div",{className:F["video-item"],onClick:()=>{c.id!==h.id&&p(h)},children:[!l&&i.is_free!==1&&e.jsx("img",{className:F["play-icon"],src:je}),e.jsxs("div",{className:F["video-title"],children:[l===!1&&i.is_free!==1&&h.free_seconds>0?e.jsx("div",{className:h.id===c.id?F["active-text"]:F.text,children:h.title}):e.jsx("div",{className:h.id===c.id?F["active-text2"]:F.text2,children:h.title}),l===!1&&i.is_free!==1&&h.free_seconds>0&&e.jsx("div",{className:F.free,children:"试看"})]})]},h.id))}),Lt="_text_4ozau_47",Et="_text2_4ozau_55",Bt="_free_4ozau_72",Pt="_active_4ozau_38",u={"video-item":"_video-item_4ozau_1","video-title":"_video-title_4ozau_18","play-icon":"_play-icon_4ozau_21","active-text":"_active-text_4ozau_38",text:Lt,text2:Et,"active-text2":"_active-text2_4ozau_63",free:Bt,"video-duration":"_video-duration_4ozau_85","sel-video-item":"_sel-video-item_4ozau_96","chapter-item":"_chapter-item_4ozau_191","chapter-name":"_chapter-name_4ozau_199","chapter-videos-box":"_chapter-videos-box_4ozau_219",active:Pt,"video-info":"_video-info_4ozau_288","active-icon":"_active-icon_4ozau_301"},Vt=({chapters:i,course:r,video:c,videos:l,isBuy:m,buyVideos:p,switchVideo:h})=>{const x=s.useRef(null);s.useEffect(()=>(i.length>0&&setTimeout(()=>{window.addEventListener("scroll",v,{passive:!0})},200),()=>{window.removeEventListener("scroll",v)}),[x,i]);const N=n=>{let T=n.current.offsetTop-289;if(T>0){let A=document.querySelector(".course-chapter-box");A.scrollTop=T}},v=()=>N(x);return e.jsxs("div",{children:[i.map(n=>e.jsxs("div",{className:u["chapter-item"],children:[e.jsx("div",{className:u["chapter-name"],children:n.title}),e.jsx("div",{className:u["chapter-videos-box"],children:l[n.id]&&l[n.id].length>0&&l[n.id].map(d=>e.jsxs("div",{className:u["video-item"],ref:c.id===d.id?x:null,onClick:()=>{c.id!==d.id&&h(d)},children:[!m&&r.is_free!==1&&e.jsx("img",{className:u["play-icon"],src:je}),e.jsxs("div",{className:u["video-title"],children:[m===!1&&r.is_free!==1&&d.free_seconds>0?e.jsx("div",{className:d.id===c.id?u["active-text"]:u.text,children:d.title}):e.jsx("div",{className:d.id===c.id?u["active-text2"]:u.text2,children:d.title}),m===!1&&r.is_free!==1&&d.free_seconds>0&&e.jsx("div",{className:u.free,children:"试看"})]})]},d.id))})]},n.id)),l[0]&&l[0].length>0&&e.jsxs("div",{className:u["chapter-item"],children:[e.jsx("div",{className:u["chapter-name"],children:"无章节内容"}),e.jsx("div",{className:u["chapter-videos-box"],children:l[0].map(n=>e.jsxs("div",{className:u["video-item"],ref:c.id===n.id?x:null,onClick:()=>{c.id!==n.id&&h(n)},children:[!m&&r.is_free!==1&&e.jsx("img",{className:u["play-icon"],src:je}),e.jsxs("div",{className:u["video-title"],children:[m===!1&&r.is_free!==1&&n.free_seconds>0?e.jsx("div",{className:n.id===c.id?u["active-text"]:u.text,children:n.title}):e.jsx("div",{className:n.id===c.id?u["active-text2"]:u.text2,children:n.title}),m===!1&&r.is_free!==1&&n.free_seconds>0&&e.jsx("div",{className:u.free,children:"试看"})]})]},n.id))})]})]})};var z=null,S=null;const Ot=()=>{const i=Ve(),r=ot(),c=Fe().pathname,[l,m]=s.useState(!1);s.useState(0);const[p,h]=s.useState(Number(r.courseId)),[x,N]=s.useState({}),[v,n]=s.useState({}),[d,T]=s.useState([]),[A,_]=s.useState([]),[b,oe]=s.useState(!1),[se,re]=s.useState([]),[le,ae]=s.useState([]),[K,W]=s.useState(!1),[Z,ie]=s.useState(0),[M,ce]=s.useState([]),[de,B]=s.useState(!1),[ue,ne]=s.useState({}),[R,G]=s.useState([]),[Se,me]=s.useState(!1),[Q,he]=s.useState(!1),[Y,X]=s.useState(null),[ve,pe]=s.useState(""),[a,o]=s.useState(!1),[I,P]=s.useState(!1),[J,Ne]=s.useState(!1),[ze,ge]=s.useState(10),[fe,Me]=s.useState(0),[O,Qe]=s.useState(4),[Je,Ae]=s.useState(!1),xe=q(t=>t.loginUser.value.user),U=q(t=>t.systemConfig.value.config),$=q(t=>t.loginUser.value.isLogin),Oe=q(t=>t.systemConfig.value.configFunc),_e=s.useRef(0),ee=s.useRef(null),Ie=[{name:"课时评论",id:4},{name:"课程附件",id:5}];s.useEffect(()=>{h(Number(r.courseId)),window.player&&window.player.destroy(),_e.current=0},[r.courseId]),s.useEffect(()=>{S&&clearInterval(S),z&&clearInterval(z),window.removeEventListener("scroll",ye,!0),window.player&&window.player.destroy()},[c]),s.useEffect(()=>(qe(),Le(),window.addEventListener("scroll",ye,!0),()=>{S&&clearInterval(S),z&&clearInterval(z),window.removeEventListener("scroll",ye,!0)}),[p]),s.useEffect(()=>{ee.current=x},[x]),s.useEffect(()=>{I&&!K&&Ze()},[I]),s.useEffect(()=>{_e.current=fe},[fe]);const ye=()=>{let t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,g=document.querySelector("#NavBar");if(g){let j=g.offsetTop;t>j?Ae(!0):Ae(!1)}},qe=()=>{l||(m(!0),dt(p).then(t=>{document.title=t.data.course.title,P(!1),S&&clearInterval(S),N(t.data.course),n(t.data.video),T(t.data.videos),_(t.data.chapters),oe(t.data.is_watch),ae(t.data.video_watched_progress),re(t.data.buy_videos);let g=parseInt(t.data.video.chapter_id)||0,j=[];if(g===0)j=t.data.videos[g];else for(var D=0;D<t.data.chapters.length;D++){let k=parseInt(t.data.chapters[D].id);typeof t.data.videos[k]<"u"&&j.push(...t.data.videos[k])}for(var C=0;C<j.length;C++)t.data.video.id===j[C].id&&(1+C>=j.length?W(!0):(W(!1),ie(j[C+1].id)));let V=null;t.data.video_watched_progress&&t.data.video_watched_progress[p]&&t.data.video_watched_progress[p].watch_seconds>0&&(V={time:5,pos:t.data.video_watched_progress[p].watch_seconds},X(V)),(t.data.is_watch||t.data.video.free_seconds>0)&&He(t.data.is_watch,t.data.video.free_seconds,t.data.video.ban_drag,V),Xe(t.data.course.id),m(!1)}))},He=(t,g,j,D)=>{let C=0;t===!1&&g>0&&(C=1),ut(p,{is_try:C}).then(V=>{if(V.data.urls.length===0){E.error("无播放地址");return}let k=V.data.urls,Be=k[0].url;if(Be.substr(1,6)==="iframe"){o(!0);let et=Be.replace(">",' style="width:100%;height:506px" >');pe(et);return}o(!1),Ke(k,C,j,D)})},Ke=(t,g,j,D)=>{rt(String(r.courseId));let C=[];t.forEach(k=>{C.push({name:k.name,url:k.url})});let V=U.player.bullet_secret.size?U.player.bullet_secret.size:14;window.player=new window.DPlayer({container:document.getElementById("meedu-player-container"),autoplay:!1,video:{quality:C,defaultQuality:0,pic:U.player.cover},try:g===1,bulletSecret:{enabled:parseInt(U.player.enabled_bullet_secret)===1,text:U.player.bullet_secret.text.replace("${user.mobile}",xe.mobile).replace("${mobile}",xe.mobile).replace("${user.id}",xe.id),size:V+"px",color:U.player.bullet_secret.color?U.player.bullet_secret.color:"red",opacity:U.player.bullet_secret.opacity},ban_drag:j===1,last_see_pos:D}),window.player.on("timeupdate",()=>{Ce(parseInt(window.player.video.currentTime),!1)}),window.player.on("ended",()=>{Ce(parseInt(window.player.video.currentTime),!0),P(!0)}),window.player.on("sub_course",()=>{ke(1)}),window.player.on("play_error",k=>{console.log("视频播放错误,错误信息:",k)}),We()},We=()=>{z=setInterval(()=>{let t=lt();t&&parseInt(t)!==Number(r.courseId)?(z&&clearInterval(z),window.player&&window.player.destroy(),Ne(!0)):Ne(!1)},5e3)},Ce=(t,g)=>{(t-_e.current>=10||g===!0)&&(Me(t),mt(p,{duration:t}).then(j=>{}))},Ze=()=>{let t=10;S=setInterval(()=>{t--,ge(t),t===0&&(S&&clearInterval(S),Ue(Z))},1e3)},Te=t=>{if(!$){be();return}S&&clearInterval(S),X(null),ge(10),i("/courses/video/"+t.id,{replace:!0})},Ue=t=>{S&&clearInterval(S),X(null),ge(10),i("/courses/video/"+t,{replace:!0})},ke=t=>{if(!$){be();return}if(t===2){Ye();return}if(t===1){i("/order?goods_id="+ee.current.id+"&goods_type=vod&goods_charge="+ee.current.charge+"&goods_label=点播课程&goods_name="+ee.current.title+"&goods_thumb="+ee.current.thumb);return}if(t===3){i("/order?goods_id="+v.id+"&goods_type=video&goods_charge="+v.charge+"&goods_label=视频&goods_name="+v.title+"&goods_thumb="+x.thumb);return}},Le=()=>{de||(B(!0),ht(p).then(t=>{ce(t.data.comments),ne(t.data.users),B(!1)}))},Ge=()=>{B(!1),ce([]),ne({})},be=()=>{let t=encodeURIComponent(window.location.pathname+window.location.search);i("/login?redirect="+t)},Ye=()=>{i("/vip")},Xe=t=>{vt(t).then(g=>{G(g.data.attach),he(g.data.isBuy),me(!g.data.isBuy)})},$e=t=>{let g=Re();if(!$){be();return}if(!Q){E.error("请购买课程后下载");return}window.open(`${U.url}/api/v2/course/attach/${t}/download?token=${g}`)},Ee=t=>{Qe(t)};return e.jsxs(e.Fragment,{children:[Je&&e.jsx("div",{className:"fix-nav",children:e.jsx("div",{className:"course-tabs",children:Ie.map(t=>e.jsxs("div",{className:O===t.id?"active item-tab":"item-tab",onClick:()=>Ee(t.id),children:[t.name,O===t.id&&e.jsx("div",{className:"actline"})]},t.id))})}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"bread-nav",children:[e.jsx("a",{onClick:()=>{i("/")},children:"首页"})," ","/",e.jsx("a",{onClick:()=>{i("/courses")},children:"录播课"})," ","/",l&&e.jsx(H.Button,{active:!0,style:{width:400,height:16}}),!l&&e.jsxs(e.Fragment,{children:[e.jsx("a",{onClick:()=>{i("/courses/detail/"+x.id)},children:x.title})," ","/",e.jsx("span",{children:v.title})]})]}),e.jsx(pt,{id:v.id,title:v.title,type:"video"}),e.jsxs("div",{className:w["course-info"],children:[e.jsxs("div",{className:w["video-box"],children:[e.jsxs("div",{className:w["play-box"],style:{backgroundImage:"url("+U.player.cover+")",backgroundSize:"cover"},children:[J&&e.jsx("div",{className:w["des-video"],children:"您已打开新视频，暂停本视频播放"}),!I&&(b||v.free_seconds>0)&&e.jsxs(e.Fragment,{children:[a&&e.jsx("div",{className:"iframe-player-box",dangerouslySetInnerHTML:{__html:ve}}),!a&&e.jsx("div",{className:"meedu-player-container",id:"meedu-player-container"})]}),(I||!b&&v.free_seconds<=0)&&e.jsxs(e.Fragment,{children:[$&&e.jsxs("div",{className:w["alert-message"],children:[I&&e.jsxs(e.Fragment,{children:[!b&&e.jsx("div",{className:w["subscribe-info"],children:"试看结束，购买课程观看所有视频"}),b&&!K&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:w["next-page"],onClick:()=>Ue(Z),children:"播放下一节课程"}),e.jsxs("div",{className:w["last-video"],children:[ze,"秒后开始自动播放下一节"]})]}),b&&K&&e.jsx("div",{className:w["last-video"],children:"恭喜你学完最后一节"})]}),x.charge>0&&b===!1&&e.jsx("div",{className:w["subscribe-button"],onClick:()=>ke(1),children:e.jsxs("span",{children:["订阅课程 ￥",x.charge]})})]}),!$&&e.jsx("div",{className:w["alert-message"],children:"登录后观看"})]})]}),e.jsxs("div",{className:"course-chapter-box",children:[l&&Array.from({length:2}).map((t,g)=>e.jsxs("div",{style:{width:260,display:"flex",flexDirection:"column"},children:[e.jsx(H.Button,{active:!0,style:{width:260,height:16,marginBottom:30}}),e.jsx(H.Button,{active:!0,style:{width:260,height:20,marginBottom:50}})]},g)),!l&&A.length>0&&e.jsx(Vt,{chapters:A,course:x,video:v,videos:d,isBuy:Q,buyVideos:se,switchVideo:t=>Te(t)}),!l&&A.length===0&&d[0]&&e.jsx(kt,{course:x,video:v,videos:d[0],isBuy:Q,buyVideos:se,switchVideo:t=>Te(t)})]})]}),e.jsx("div",{className:"course-tabs",id:"NavBar",children:Ie.map(t=>e.jsxs("div",{className:O===t.id?"active item-tab":"item-tab",onClick:()=>Ee(t.id),children:[t.name,O===t.id&&e.jsx("div",{className:"actline"})]},t.id))})]}),O===4&&e.jsx(bt,{fresh:l,vid:p,isBuy:Q,comments:M,commentUsers:ue,success:()=>{Ge(),Le()}}),O===5&&e.jsxs("div",{className:w["attach-list-box"],children:[R.length===0&&e.jsx(De,{}),R.length>0&&R.map(t=>e.jsxs("div",{className:w["attach-item"],children:[e.jsx("div",{className:w["attach-name"],children:t.name}),e.jsx("a",{onClick:()=>$e(t.id),className:w["download-attach"],children:"下载附件"})]},t.id))]}),Oe.snapshort&&b&&e.jsx(Nt,{id:p,duration:fe,resourceType:"vod"})]})]})};export{Ot as default};
