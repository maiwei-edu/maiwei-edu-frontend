import{Y as a,u as N,ad as L,p as n,v as V,al as K,s as e,I as p,am as j,an as B,ao as M,D as q,t as y,ap as D,as as E,cL as R,cM as A,aw as z,aB as P,cN as T,cK as U}from"./index-c4424654.js";const Y="_box_14x1o_1",$="_title_14x1o_10",G="_buttons_14x1o_21",c={box:Y,title:$,buttons:G,"send-sms-button":"_send-sms-button_14x1o_26"};var i=null;const J=()=>{const[l]=a.useForm(),d=N(),_=L(),[x,h]=n.useState(!1),[b,v]=n.useState({key:null,img:null}),[C,o]=n.useState(0),[u,r]=n.useState(!1),[m,g]=n.useState(!1),F=V(s=>s.systemConfig.value.config);n.useEffect(()=>(document.title="绑定新手机号",l.setFieldsValue({mobile:"",captcha:"",sms:""}),r(!1),o(120),f(),()=>{i&&clearInterval(i)}),[]);const f=()=>{K().then(s=>{v(s.data)})},I=()=>{if(!u&&!m){if(!l.getFieldValue("captcha")){y.error("请输入图形验证码");return}r(!0),g(!0),D({mobile:l.getFieldValue("mobile"),image_key:b.key,image_captcha:l.getFieldValue("captcha"),scene:"mobile_bind"}).then(s=>{g(!1);let t=120;i=setInterval(()=>{t--,o(t),t===0&&(i&&clearInterval(i),o(120),r(!1))},1e3)}).catch(s=>{g(!1),l.setFieldsValue({captcha:""}),f(),i&&clearInterval(i),o(120),r(!1)})}},k=s=>{x||(h(!0),E({mobile:s.mobile,mobile_code:s.sms}).then(t=>{h(!1),y.success("绑定成功"),R(),A()==="ok"?d("/face-check"):S()}).catch(t=>{h(!1)}))},w=s=>{console.log("Failed:",s)},S=()=>{z().then(s=>{let t=s.data;_(P(t)),t.is_face_verify===!1&&F.member.enabled_face_verify===!0?(T(),d("/face-check",{replace:!0})):(U(),d("/",{replace:!0}))})};return e.jsx("div",{children:e.jsxs("div",{className:c.box,children:[e.jsx("div",{className:c.title,children:"请绑定手机号"}),e.jsxs(a,{form:l,name:"bind-new-mobile-page",labelCol:{span:0},wrapperCol:{span:24},initialValues:{remember:!0},onFinish:k,onFinishFailed:w,autoComplete:"off",style:{marginTop:30},children:[e.jsx(a.Item,{name:"mobile",rules:[{required:!0,message:"请输入手机号"}],children:e.jsx(p,{style:{width:440,height:54},autoComplete:"off",placeholder:"请输入手机号"})}),e.jsx(a.Item,{children:e.jsxs(j,{align:"baseline",style:{height:54},children:[e.jsx(a.Item,{name:"captcha",rules:[{required:!0,message:"请输入图形验证码"}],children:e.jsx(p,{style:{width:310,height:54,marginRight:10},autoComplete:"off",placeholder:"请输入图形验证码"})}),e.jsx(B,{onClick:()=>f(),src:b.img,width:110,height:39,preview:!1,style:{cursor:"pointer"}})]})}),e.jsx(a.Item,{children:e.jsxs(j,{align:"baseline",style:{height:54},children:[e.jsx(a.Item,{name:"sms",rules:[{required:!0,message:"请输入短信验证码"}],children:e.jsx(p,{style:{width:310,height:54,marginRight:30},autoComplete:"off",placeholder:"请输入短信验证码"})}),e.jsxs("div",{className:c.buttons,children:[m&&e.jsx("div",{style:{width:90,textAlign:"center"},children:e.jsx(M,{size:"small"})}),!m&&u&&e.jsxs("div",{className:c["send-sms-button"],children:[C,"s"]}),!u&&!m&&e.jsx("div",{className:c["send-sms-button"],onClick:()=>I(),children:"获取验证码"})]})]})}),e.jsx(a.Item,{children:e.jsx(q,{style:{width:440,height:54,outline:"none"},type:"primary",onClick:()=>l.submit(),loading:x,children:"立即绑定"})})]})]})})};export{J as default};
