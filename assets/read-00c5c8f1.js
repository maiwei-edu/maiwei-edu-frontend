import{u as Le,F as ze,p as c,v as ne,G as Fe,H as Ue,s as e,S as ce,J as Pe,I as J,D as f,z as De,E as le,t as E}from"./index-bc9ff81c.js";import{e as He,f as $e,g as re,i as ie}from"./book-5040e675.js";import{E as Ge}from"./index-5aae9b85.js";import{b as Je}from"./icon-back-h-0fef6b27.js";import{d as oe}from"./default-avatar-e291781e.js";const Me="_content_1y6j0_16",qe="_navheader_1y6j0_22",Ke="_top_1y6j0_30",Oe="_button_1y6j0_59",Qe="_chapter_1y6j0_94",Ve="_title_1y6j0_115",We="_text_1y6j0_138",Xe="_free_1y6j0_158",Ye="_read_1y6j0_78",Ze="_line_1y6j0_239",Ie="_tit_1y6j0_115",et="_replybox_1y6j0_355",tt="_reply_1y6j0_355",st="_avatar_1y6j0_441",at="_nickname_1y6j0_466",nt="_diff_1y6j0_474",ct="_page_1y6j0_1",s={content:Me,navheader:qe,top:Ke,"top-left":"_top-left_1y6j0_43","icon-back":"_icon-back_1y6j0_49","top-right":"_top-right_1y6j0_54",button:Oe,"read-box":"_read-box_1y6j0_78","left-box":"_left-box_1y6j0_88","chapter-list-box":"_chapter-list-box_1y6j0_94",chapter:Qe,title:Ve,"chapter-articles-box":"_chapter-articles-box_1y6j0_124","act-article-item":"_act-article-item_1y6j0_128","video-title":"_video-title_1y6j0_138",text:We,free:Xe,"article-item":"_article-item_1y6j0_170","right-box":"_right-box_1y6j0_215",read:Ye,line:Ze,"u-content":"_u-content_1y6j0_245","buy-button":"_buy-button_1y6j0_258","role-button":"_role-button_1y6j0_277","book-comments-box":"_book-comments-box_1y6j0_295","active-book-comments":"_active-book-comments_1y6j0_299",tit:Ie,"book-comments":"_book-comments_1y6j0_295",replybox:et,reply:tt,"user-avatar":"_user-avatar_1y6j0_371","reply-input":"_reply-input_1y6j0_378","disabled-button":"_disabled-button_1y6j0_388","btn-submit":"_btn-submit_1y6j0_405","comments-list-box":"_comments-list-box_1y6j0_423","comment-item":"_comment-item_1y6j0_430",avatar:st,"comment-content":"_comment-content_1y6j0_453","top-info":"_top-info_1y6j0_458",nickname:at,diff:nt,"reply-answer-box":"_reply-answer-box_1y6j0_492","reply-trans-answer":"_reply-trans-answer_1y6j0_497","reply-answer":"_reply-answer_1y6j0_492","one-class-replybox":"_one-class-replybox_1y6j0_513","input-box":"_input-box_1y6j0_521","confirm-button":"_confirm-button_1y6j0_530","reply-list-box":"_reply-list-box_1y6j0_562","reply-list-item":"_reply-list-item_1y6j0_572","reply-avatar":"_reply-avatar_1y6j0_581","reply-content":"_reply-content_1y6j0_593","reply-nickname":"_reply-nickname_1y6j0_607","red-reply-nickname":"_red-reply-nickname_1y6j0_616","reply-diff":"_reply-diff_1y6j0_625","reply-text":"_reply-text_1y6j0_632","answer-item":"_answer-item_1y6j0_641","Two-class-replybox":"_Two-class-replybox_1y6j0_650",page:ct},jt=()=>{const p=Le(),z=ze(),[y,T]=c.useState(Number(z.courseId)),[i,de]=c.useState({}),[_,_e]=c.useState({}),[F,me]=c.useState([]),[x,ue]=c.useState({}),[U,he]=c.useState(!1),[B,M]=c.useState(!1),[R,pe]=c.useState(!1),[je,q]=c.useState("展开目录"),[A,ye]=c.useState(!1),[P,xe]=c.useState(0),[D,ve]=c.useState(0),[v,N]=c.useState([]),[lt,K]=c.useState({}),[b,m]=c.useState(!1),[g,O]=c.useState(""),[H,Q]=c.useState([]),[o,k]=c.useState([]),[C,$]=c.useState([]),[d,w]=c.useState(""),[rt,be]=c.useState(0),[it,V]=c.useState(0),[W,ot]=c.useState(1),[X,dt]=c.useState(1e4),h=ne(t=>t.loginUser.value.user),Y=ne(t=>t.loginUser.value.isLogin);c.useEffect(()=>{ge(),fe()},[y]),c.useEffect(()=>{T(Number(z.courseId))},[z.courseId]),c.useEffect(()=>{Fe(document.getElementById("desc")),Ue(document.getElementById("desc"))},[document.getElementById("desc")]);const ge=()=>{B||(M(!0),He(y).then(t=>{document.title=t.data.article.title,de(t.data.book),_e(t.data.article);let n=t.data.chapters,a=t.data.articles;n.length>0&&a[0]&&a[0].length>0&&n.push({id:0,name:"无章节内容",sort:1e4}),me(n),ue(a),he(t.data.can_see),pe(t.data.can_see);let l=parseInt(t.data.prev_id);xe(l);let r=parseInt(t.data.next_id);ve(r),M(!1)}))},fe=()=>{b||(m(!0),$e(y,{page:1,size:1e4}).then(t=>{N(t.data.data.data),K(t.data.users),m(!1)}))},G=()=>{m(!1),N([]),K({})},Z=()=>{p("/book/detail/"+i.id+"?tab=3")},Ne=()=>{q(A?"展开目录":"收起目录"),ye(!A)},ke=t=>{if(t!==y){if(P===0){E.error("没有上一节");return}G(),p("/book/read/"+t),T(t),document.body.scrollTop=document.documentElement.scrollTop=0}},Ce=t=>{if(t!==y){if(D===0){E.error("没有下一节");return}G(),p("/book/read/"+t),T(t),document.body.scrollTop=document.documentElement.scrollTop=0}},I=t=>{t.id!==_.id&&(G(),p("/book/read/"+t.id),T(t.id),document.body.scrollTop=document.documentElement.scrollTop=0)},we=()=>{p("/vip")},Se=()=>{p("/order?goods_id="+i.id+"&goods_type=book&goods_charge="+i.charge+"&goods_label=电子书&goods_name="+i.name+"&goods_thumb="+i.thumb)},Ee=()=>{b||g!==""&&(m(!0),re(y,{content:g}).then(t=>{E.success("评论成功");let n={id:t.data.comment_id,is_check:0,parent_id:0,content:g,children_count:0,reply_id:0,reply:null,created_at:"刚刚",user:{avatar:h.avatar,nick_name:h.nick_name}},a=[...v];a.unshift(n),N(a);let l=[...o];l.unshift(!1),k(l);let r=[...C];r.unshift(!1),$(r),O(""),m(!1)}).catch(t=>{m(!1)}))},ee=t=>{if(!Y){Te();return}let n=[];n[t]=!0,Q(n),w("")},Te=()=>{let t=encodeURIComponent(window.location.pathname+window.location.search);p("/login?redirect="+t)},Be=(t,n)=>{if(n===0)return;let a=[...C];a[t]=!a[t],$(a),V(n),ie(_.id,{page:W,page_size:X,parent_id:n}).then(l=>{let r=[...o];r[t]=l.data.data.data,k(r)})},te=(t,n,a,l)=>{if(!b){if(!a){E.error("回复的用户不存在");return}d&&(be(n),m(!0),re(_.id,{parent_id:t,content:d,reply_id:n}).then(r=>{let Re=_.id;Q([]),E.success("回复成功"),m(!1);let L;if(n){L={id:r.data.comment_id,parent_id:t,content:d,children_count:0,reply_id:r.data.reply_id,created_at:"刚刚",user:{avatar:h.avatar,nick_name:h.nick_name}};let u;o[l]?(u=o[l],u.unshift(L)):u=[];let S=[...o];S[l]=u,k(S);let j=[...v];j[l].children_count=j[l].children_count+1,N(j),w("")}else{L={id:r.data.comment_id,parent_id:t,content:d,children_count:0,reply_id:r.data.reply_id,reply:null,created_at:"刚刚",user:{avatar:h.avatar,nick_name:h.nick_name}};let u;o[l]?(u=o[l],u.unshift(L)):u=[];let S=[...o];S[l]=u,k(S);let j=[...v];j[l].children_count=j[l].children_count+1,N(j),w("");let se=[...C];se[l]=!0,$(se),V(t),ie(Re,{page:W,page_size:X,parent_id:t}).then(Ae=>{let ae=[...o];ae[l]=Ae.data.data.data,k(ae)})}}).catch(r=>{m(!1)}))}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:s.content,children:[e.jsx("div",{className:s.navheader,children:e.jsxs("div",{className:s.top,children:[e.jsxs("div",{className:s["top-left"],children:[e.jsx("img",{onClick:()=>Z(),className:s["icon-back"],src:Je}),e.jsx("span",{onClick:()=>Z(),children:i.name})]}),e.jsxs("div",{className:s["top-right"],children:[e.jsx("div",{className:s.button,onClick:()=>Ne(),children:je}),P!==0&&e.jsx("div",{className:s.button,onClick:()=>ke(P),children:"上一节"}),D!==0&&e.jsx("div",{className:s.button,onClick:()=>Ce(D),children:"下一节"})]})]})}),e.jsxs("div",{className:s["read-box"],children:[A&&e.jsx("div",{className:s["left-box"],children:e.jsxs("div",{className:s["chapter-list-box"],children:[F.length>0&&F.map(t=>e.jsxs("div",{className:s.chapter,children:[e.jsx("div",{className:s.title,children:t.name}),x[t.id]&&x[t.id].length>0&&e.jsx("div",{className:s["chapter-articles-box"],children:x[t.id].map(n=>e.jsx("div",{className:_.id===n.id?s["act-article-item"]:s["article-item"],onClick:()=>I(n),children:e.jsxs("div",{className:s["video-title"],children:[e.jsx("div",{className:s.text,children:n.title}),!U&&i.charge>0&&n.charge===0&&e.jsx("div",{className:s.free,children:"试读"})]})},n.id))})]},t.id)),F.length===0&&x[0]&&x[0].length>0&&e.jsx("div",{className:s.chapter,children:e.jsx("div",{className:s["chapter-articles-box"],children:x[0].map(t=>e.jsx("div",{className:_.id===t.id?s["act-article-item"]:s["article-item"],onClick:()=>I(t),children:e.jsxs("div",{className:s["video-title"],children:[e.jsx("div",{className:s.text,children:t.title}),!U&&i.charge>0&&t.charge===0&&e.jsx("div",{className:s.free,children:"试读"})]})},t.id))})})]})}),e.jsxs("div",{className:s["right-box"],children:[B&&e.jsxs("div",{className:s.read,children:[e.jsx(ce.Button,{active:!0,style:{width:806,height:48,marginBottom:30}}),e.jsx("div",{className:s.line}),e.jsx(ce,{active:!0,paragraph:{rows:3}})]}),!B&&R&&e.jsxs("div",{className:s.read,children:[e.jsx("div",{className:s.title,children:_.title}),e.jsx("div",{className:s.line}),e.jsx("div",{className:"u-content md-content",id:"desc",dangerouslySetInnerHTML:{__html:_.render_content}})]}),!B&&!R&&U===!1&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:s.title,children:_.title}),i.charge>0&&e.jsxs("div",{className:s["buy-button"],onClick:()=>Se(),children:["订阅电子书￥",i.charge]}),i.charge>0&&i.is_vip_free===1&&!Pe.disable_vip&&e.jsx("div",{className:s["buy-button"],onClick:()=>we(),children:"会员免费看"})]})]})]}),e.jsx("div",{className:s["book-comments-box"],children:e.jsxs("div",{className:A?s["active-book-comments"]:s["book-comments"],children:[Y&&R&&e.jsx("div",{className:s.replybox,children:e.jsxs("div",{className:s.reply,children:[h&&e.jsx("img",{className:s["user-avatar"],src:h.avatar}),e.jsx(J,{className:s["reply-input"],onChange:t=>{O(t.target.value)},value:g,placeholder:"此处填写你的评论"}),g===""&&e.jsx(f,{type:"primary",className:s["disabled-button"],children:"评论"}),g!==""&&e.jsx(f,{type:"primary",className:s["btn-submit"],onClick:()=>Ee(),loading:b,children:"评论"})]})}),e.jsx("div",{className:s.tit,children:"全部评论"}),e.jsx("div",{className:s.line}),e.jsxs("div",{className:s["comments-list-box"],children:[v.length===0&&e.jsx(De,{span:24,children:e.jsx(Ge,{})}),v.length>0&&v.map((t,n)=>e.jsxs("div",{className:s["comment-item"],children:[e.jsxs("div",{className:s.avatar,children:[t.user.length!==0&&e.jsx("img",{src:t.user.avatar}),t.user.length===0&&e.jsx("img",{src:oe})]}),e.jsxs("div",{className:s["comment-content"],children:[e.jsxs("div",{className:s["top-info"],children:[t.user.length===0&&e.jsx("div",{className:s.nickname,children:"未知用户"}),t.user.length!==0&&e.jsx("div",{className:s.nickname,children:t.user.nick_name}),e.jsx("div",{className:s.diff,children:le(t.created_at)})]}),e.jsx("div",{className:s.text,children:t.content}),e.jsxs("div",{className:s["reply-answer-box"],children:[R&&t.user.length!==0&&e.jsx("div",{className:H[n]===!0?s["reply-trans-answer"]:s["reply-answer"],onClick:()=>ee(t.id),children:"回复"}),t.children_count!==0&&e.jsxs("div",{className:C[n]===!0?s["reply-trans-answer"]:s["reply-answer"],onClick:()=>Be(n,t.id),children:[t.children_count,"回复"]})]}),H[t.id]===!0&&e.jsxs("div",{className:s["one-class-replybox"],children:[e.jsx(J,{className:s["input-box"],value:d,onChange:a=>{w(a.target.value)},placeholder:"回复"+t.user.nick_name}),d===""&&e.jsx(f,{type:"primary",className:s["disabled-button"],children:"发表回复"}),d!==""&&e.jsx(f,{type:"primary",className:s["confirm-button"],onClick:()=>te(t.id,t.reply_id,t.user.nick_name,n),loading:b,children:"发表回复"})]}),C[n]===!0&&e.jsx("div",{className:s["reply-list-box"],children:o.length>0&&o[n]&&o[n].map(a=>e.jsxs("div",{className:s["reply-list-item"],children:[e.jsxs("div",{className:s["reply-avatar"],children:[a.user.length!==0&&e.jsx("img",{src:a.user.avatar}),a.user.length===0&&e.jsx("img",{src:oe})]}),e.jsxs("div",{className:s["reply-content"],children:[e.jsxs("div",{className:s["top-info"],children:[a.user.length===0&&e.jsx("div",{className:s["red-reply-nickname"],children:"未知用户"}),a.user.length!==0&&e.jsx("div",{className:s["reply-nickname"],children:e.jsxs(e.Fragment,{children:[a.user.nick_name,a.reply!=null&&e.jsxs(e.Fragment,{children:["回复：",a.reply.user.nick_name]})]})}),e.jsx("div",{className:s["reply-diff"],children:le(a.created_at)})]}),e.jsx("div",{className:s["reply-text"],children:a.content}),a.user.length!==0&&e.jsx("div",{className:s["answer-item"],onClick:()=>ee(a.id),children:"回复"}),H[a.id]===!0&&e.jsxs("div",{className:s["Two-class-replybox"],children:[e.jsx(J,{className:s["input-box"],value:d,onChange:l=>{w(l.target.value)},placeholder:"回复"+a.user.nick_name}),d===""&&e.jsx(f,{type:"primary",className:s["disabled-button"],children:"发表回复"}),d!==""&&e.jsx(f,{type:"primary",className:s["confirm-button"],onClick:()=>te(t.id,a.id,a.user.nick_name,n),loading:b,children:"发表回复"})]})]})]},a.id))})]})]},t.id))]})]})})]})})};export{jt as default};
