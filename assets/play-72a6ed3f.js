import{u as te,y as oe,p as i,v as ae,t as y,s,a2 as O,D}from"./index-c4424654.js";import{b as ne,c as re,d as ce}from"./paper-53edf389.js";import{c as le,a as ie}from"./practice-a2c369be.js";import{b as ue}from"./icon-back-h-0fef6b27.js";import{c as de,n as pe}from"./icon-collect-n-7dad1c8c.js";import{C as _e,S as me,I as fe,Q as he,J as xe,a as be}from"./index-84678de9.js";import"./index-17003175.js";import"./index-7728a9ab.js";import"./useForceUpdate-dbe4ad3d.js";const ge="_navheader_b5dca_1",ve="_top_b5dca_9",je="_score_b5dca_39",ye="_button_b5dca_65",Se="_num_b5dca_99",ke="_item_b5dca_234",a={navheader:ge,top:ve,"top-left":"_top-left_b5dca_22","icon-back":"_icon-back_b5dca_28","top-right":"_top-right_b5dca_34",score:je,"score-info":"_score-info_b5dca_49","remaining-time":"_remaining-time_b5dca_57",button:ye,"paper-box":"_paper-box_b5dca_79","fix-left-box":"_fix-left-box_b5dca_88","number-box":"_number-box_b5dca_99","active-num":"_active-num_b5dca_108","act-num":"_act-num_b5dca_125","no-num":"_no-num_b5dca_142","error-num":"_error-num_b5dca_159","correct-num":"_correct-num_b5dca_176",num:Se,"right-box":"_right-box_b5dca_209","title-box":"_title-box_b5dca_216","questions-box":"_questions-box_b5dca_229",item:ke,"collect-icon":"_collect-icon_b5dca_243"};var g=null;const Qe=()=>{const v=te(),B=new URLSearchParams(oe().search);i.useState(!1);const[r,L]=i.useState({}),[_,J]=i.useState({}),[d,U]=i.useState([]),[R,p]=i.useState({}),[S,k]=i.useState({}),[C,P]=i.useState(0),[H,w]=i.useState(!1),[W,N]=i.useState(!1),[z,m]=i.useState(!1),[Ce,G]=i.useState(0),[we,E]=i.useState(0),[q,K]=i.useState({day:0,hr:0,min:0,sec:0}),[M,T]=i.useState(!1),[j,Ne]=i.useState(Number(B.get("id"))||0),[h,qe]=i.useState(Number(B.get("pid"))||0);ae(e=>e.systemConfig.value.configFunc),i.useEffect(()=>(Q(),()=>{g&&clearInterval(g)}),[j,h]);const Q=()=>{ne(j,h).then(e=>{document.title=e.data.paper.title,J(e.data.paper),L(e.data.user_paper);let t=e.data.questions;if(t.length===0){y.error("未获取到试题"),v("/exam/papers");return}let n=0,o={};t.forEach(u=>{u.answer_content?o[u.question_id]=!0:n++}),p(o),U(t),P(n);let c=new Date(e.data.user_paper.ended_at.replace(/-/g,"/"));const l=Math.floor(Date.parse(c));G(l),e.data.user_paper.status===1?X(l):e.data.user_paper.status===2&&V(t)})},V=e=>{let t=e,n=[];for(let o=0;o<t.length;o++)n.push(t[o].question_id);le({question_ids:n}).then(o=>{k(o.data)})},X=e=>{const t=new Date,n=Date.parse(t);let o=(e-n)/1e3;if(o<=0){let c=parseInt(_.expired_minutes)*60;E(c),I();return}g=setInterval(()=>{if(o>0){o--;let c=Math.floor(o/3600/24),l=Math.floor(o/3600%24),u=Math.floor(o/60%60),x=Math.floor(o%60);K({day:c,hr:l<10?"0"+l:l,min:u<10?"0"+u:u,sec:x<10?"0"+x:x})}else{let c=parseInt(_.expired_minutes)*60-Math.floor(o);E(c),I()}},1e3)},I=()=>{g&&clearInterval(g),Y()},Y=()=>{M||(T(!0),re(j,{pid:h}).then(e=>{T(!1);let t=e.data.status,n=e.data.total_score;m(!1),t===2?(y.success("考试结束，得分："+n),Q()):N(!0)}).catch(e=>{T(!1)}))},Z=()=>{r.status===1?w(!1):(A(),v(-1))},$=()=>{N(!1),m(!1),setTimeout(()=>{v(-1)},500)},A=()=>{N(!1),m(!1),w(!1)},F=e=>{let t=document.getElementById(String(e));document.documentElement.scrollTop=t.offsetTop},ee=()=>{m(!0)},se=e=>{let t={...S};ie({question_id:e}).then(()=>{t[e]===1?(y.success("已取消收藏"),t[e]=0,k(t)):(y.success("已收藏试题"),t[e]=1,k(t))})},f=(e,t,n)=>{let o={pid:h,answer:t,question_id:e};n&&(o={pid:h,images:n,answer:t,question_id:e}),ce(j,o).then(c=>{let l=R;if(typeof e=="string"&&e.indexOf("-")!=-1)if(t==="")if(n&&n.length>0){let b=e.substring(0,e.indexOf("-"));l[b]=!0,p(l)}else{let b=e.substring(0,e.indexOf("-"));l[b]=!1,p(l)}else{let b=e.substring(0,e.indexOf("-"));l[b]=!0,p(l)}else t===""?n&&n.length>0?(l[e]=!0,p(l)):(l[e]=!1,p(l)):(l[e]=!0,p(l));let u=Object.keys(l).length,x=d.length-u;P(x)})};return s.jsxs("div",{className:"full-container",children:[H?s.jsx(O,{title:"确认信息",centered:!0,forceRender:!0,maskClosable:!1,open:!0,width:500,onOk:()=>{A(),setTimeout(()=>{v(-1)},500)},onCancel:()=>w(!1),children:s.jsx("div",{className:a.text,children:"正在考试中,是否确认返回?"})}):null,z?s.jsxs(O,{title:"确认信息",centered:!0,forceRender:!0,maskClosable:!1,open:!0,width:500,onCancel:()=>m(!1),footer:null,children:[C!==0&&s.jsxs("div",{className:a.text,children:["还有",C,"道题未做，确认要交卷吗？"]}),C===0&&s.jsx("div",{className:a.text,children:"确认要交卷吗？"}),s.jsxs("div",{slot:"footer",style:{display:"flex",flexDirection:"row-reverse",marginTop:15},children:[s.jsx(D,{type:"primary",onClick:()=>I(),loading:M,children:"确定"}),s.jsx(D,{style:{marginRight:15},onClick:()=>m(!1),children:"继续答题"})]})]}):null,W?s.jsxs(O,{title:"交卷提示",centered:!0,forceRender:!0,maskClosable:!1,open:!0,width:500,closable:!1,footer:null,children:[s.jsx("div",{className:a.text,children:"此次在线考试包含主观题，等待老师阅卷后查看成绩"}),s.jsx("div",{slot:"footer",style:{display:"flex",flexDirection:"row-reverse",marginTop:15},children:s.jsx(D,{type:"primary",onClick:()=>$(),children:"我知道了"})})]}):null,s.jsx("div",{className:a.navheader,children:s.jsxs("div",{className:a.top,children:[r&&r.status===1&&s.jsx("div",{className:a["top-left"],children:_.title}),r&&r.status===2&&s.jsxs("div",{className:a["top-left"],onClick:()=>Z(),children:[s.jsx("img",{className:a["icon-back"],src:ue}),_.title]}),s.jsxs("div",{className:a["top-right"],children:[r&&r.status===2&&s.jsxs("div",{className:a.score,children:["考试得分：",s.jsxs("strong",{children:[r.score,"分"]})]}),r&&r.status===1&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:a["score-info"],children:["及格分：",_.pass_score,"分/",_.score,"分"]}),s.jsxs("div",{className:a["remaining-time"],children:["倒计时：",q.hr,"时",q.min,"分",q.sec,"秒"]}),s.jsx("div",{className:a.button,onClick:()=>ee(),children:"立即交卷"})]})]})]})}),s.jsxs("div",{className:a["paper-box"],children:[s.jsxs("div",{className:a["fix-left-box"],children:[d.length>0&&r&&r.status===1&&s.jsx("div",{className:a["number-box"],children:d.map((e,t)=>s.jsx("div",{className:R[e.question_id]?a["active-num"]:a.num,onClick:()=>F(t),children:t+1},t))}),d.length>0&&r&&r.status===2&&s.jsx("div",{className:a["number-box"],children:d.map((e,t)=>s.jsx("div",{className:e.is_correct===1?a["correct-num"]:e.is_correct===0?a["error-num"]:e.is_correct===2?a["act-num"]:e.is_correct===3?a["no-num"]:a.num,onClick:()=>F(t),children:t+1},t))})]}),s.jsx("div",{className:a["right-box"],children:d.length>0&&r&&s.jsx("div",{className:a["questions-box"],children:d.map((e,t)=>s.jsxs("div",{className:a.item,id:String(t),children:[r.status===2&&s.jsxs("div",{className:a["collect-icon"],onClick:()=>se(e.question_id),children:[S[e.question_id]===1&&s.jsxs(s.Fragment,{children:[s.jsx("img",{src:de}),s.jsx("strong",{children:"已收藏"})]}),S[e.question_id]!==1&&s.jsxs(s.Fragment,{children:[s.jsx("img",{src:pe}),"收藏试题"]})]}),e.question.type===1&&s.jsx(_e,{num:t+1,question:e.question,reply:e.answer_content,score:e.score,isCorrect:e.is_correct,isOver:r.status===2,wrongBook:!1,update:(n,o,c)=>{f(n,o,c)}},e.question_id),e.question.type===2&&s.jsx(me,{num:t+1,question:e.question,reply:e.answer_contents_rows,score:e.score,isCorrect:e.is_correct,isOver:r.status===2,wrongBook:!1,update:(n,o,c)=>{f(n,o,c)}},e.question_id),e.question.type===3&&s.jsx(fe,{num:t+1,question:e.question,reply:e.answer_contents_rows,score:e.score,isCorrect:e.is_correct,isOver:r.status===2,wrongBook:!1,update:(n,o,c)=>{f(n,o,c)}},e.question_id),e.question.type===4&&s.jsx(he,{num:t+1,question:e.question,reply:e.answer_content,thumbs:e.thumbs_rows,score:e.score,isCorrect:e.is_correct,isOver:r.status===2,showImage:!0,wrongBook:!1,update:(n,o,c)=>{f(n,o,c)}},e.question_id),e.question.type===5&&s.jsx(xe,{num:t+1,question:e.question,reply:e.answer_contents_rows,score:e.score,isCorrect:e.is_correct,isOver:r.status===2,wrongBook:!1,update:(n,o,c)=>{f(n,o,c)}},e.question_id),e.question.type===6&&s.jsx(be,{num:t+1,question:e.question,reply:e.answer_contents_rows,score:e.score,isCorrect:e.is_correct,isOver:r.status===2,showImage:!0,wrongBook:!1,update:(n,o,c)=>{f(n,o,c)}},e.question_id)]},t))})})]})]})};export{Qe as default};
