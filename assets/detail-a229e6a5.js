import{u as Q,v as k,p as o,s as e,B as m,I as pe,D as Ne,E as ye,t as B,y as Ce,F as ke,G as Se,H as we,S as L,J as Te,K as Le}from"./index-e91a7de6.js";import{s as Be,d as Ie,a as De,b as Ee}from"./course-823625d7.js";import{d as Ve,a as $e,M as Fe,b as Me,T as Re}from"./index-20d5786c.js";import{E as W}from"./index-155c943d.js";import{T as He}from"./index-047bb51b.js";import{H as Ue}from"./index-f4d21fdb.js";import{D as V}from"./index-9ce4760a.js";import{l as $}from"./icon-lock-b2682a8d.js";import{c as Pe,n as ze}from"./icon-collect-n-7dad1c8c.js";const Oe=({cid:l,isBuy:x,comments:u,commentUsers:h,success:j})=>{const _=Q(),d=k(r=>r.loginUser.value.user),c=k(r=>r.loginUser.value.isLogin),[C,t]=o.useState(""),[S,b]=o.useState(!1),I=()=>{S||C!==""&&(b(!0),Be(l,{content:C}).then(()=>{B.success("成功"),t(""),b(!1),j()}).catch(r=>{b(!1)}))};return e.jsxs("div",{className:m["course-comments-box"],children:[e.jsx("div",{className:m["comment-divider"],children:"全部评论"}),e.jsx("div",{className:m.line}),c&&x&&e.jsx("div",{className:m.replybox,children:e.jsxs("div",{className:m.reply,children:[e.jsx("img",{className:m["user-avatar"],src:d.avatar}),e.jsx(pe,{value:C,onChange:r=>{t(r.target.value)},style:{width:960,height:48,marginRight:30,fontSize:16},placeholder:"此处填写你的评论"}),e.jsx(Ne,{type:"primary",disabled:C.length===0,style:{width:72,height:48,fontSize:16,border:"none"},onClick:()=>{I()},loading:S,children:"评论"})]})}),!c&&e.jsx("div",{className:m.replybox,children:e.jsx("div",{className:m.text,onClick:()=>_("/login"),children:"未登录，请登录后再评论"})}),e.jsxs("div",{className:m["comment-top"],children:[u.length===0&&e.jsx(W,{}),u.length>0&&u.map(r=>e.jsxs("div",{className:m["comment-item"],children:[e.jsx("div",{className:m["user-avatar"],children:e.jsx("img",{src:h[r.user_id].avatar})}),e.jsxs("div",{className:m["comment-content"],children:[e.jsxs("div",{className:m["comment-info"],children:[e.jsx("div",{className:m.nickname,children:h[r.user_id].nick_name}),e.jsx("div",{className:m["comment-time"],children:ye(r.created_at)})]}),e.jsx("div",{className:m["comment-text"],dangerouslySetInnerHTML:{__html:r.render_content}})]})]},r.id))]})]})},qe="_status_coas0_24",Ae="_info_coas0_34",Ge="_desc_coas0_61",a={"course-info":"_course-info_coas0_1","course-info-box":"_course-info-box_coas0_7","course-thumb":"_course-thumb_coas0_16",status:qe,info:Ae,"course-info-title":"_course-info-title_coas0_40","collect-button":"_collect-button_coas0_53",desc:Ge,"btn-box":"_btn-box_coas0_72","has-button":"_has-button_coas0_82","buy-button":"_buy-button_coas0_93","role-button":"_role-button_coas0_107","coursr-desc":"_coursr-desc_coas0_123","course-chapter-box":"_course-chapter-box_coas0_135","attach-list-box":"_attach-list-box_coas0_144","attach-item":"_attach-item_coas0_154","attach-name":"_attach-name_coas0_166","download-attach":"_download-attach_coas0_174"},Je="_free_1kg4b_36",y={"video-item":"_video-item_1kg4b_1","video-title":"_video-title_1kg4b_17","play-icon":"_play-icon_1kg4b_20",free:Je,"video-duration":"_video-duration_1kg4b_49"},Ke=({course:l,videos:x,isBuy:u,buyVideos:h,switchVideo:j})=>e.jsx(e.Fragment,{children:x.length>0&&x.map(_=>e.jsxs("div",{className:y["video-item"],onClick:()=>j(_),children:[!u&&l.is_free!==1&&e.jsx("img",{className:y["play-icon"],src:$}),e.jsxs("div",{className:y["video-title"],children:[e.jsx("div",{className:y.text,children:_.title}),u===!1&&l.is_free!==1&&_.free_seconds>0&&e.jsx("div",{className:y.free,children:"试看"})]}),e.jsx("div",{className:y["video-duration"],children:e.jsx(V,{seconds:_.duration})})]},_.id))}),Ye="_free_18sts_36",n={"video-item":"_video-item_18sts_1","video-title":"_video-title_18sts_17","play-icon":"_play-icon_18sts_20",free:Ye,"video-duration":"_video-duration_18sts_49","chapter-item":"_chapter-item_18sts_60","chapter-name":"_chapter-name_18sts_68","chapter-videos-box":"_chapter-videos-box_18sts_84","video-info":"_video-info_18sts_133"},Qe=({chapters:l,course:x,videos:u,isBuy:h,buyVideos:j,switchVideo:_})=>e.jsxs("div",{children:[l.map(d=>e.jsxs("div",{className:n["chapter-item"],children:[e.jsx("div",{className:n["chapter-name"],children:d.title}),e.jsx("div",{className:n["chapter-videos-box"],children:u[d.id]&&u[d.id].length>0&&u[d.id].map(c=>e.jsxs("div",{className:n["video-item"],onClick:()=>_(c),children:[!h&&x.is_free!==1&&e.jsx("img",{className:n["play-icon"],src:$}),e.jsxs("div",{className:n["video-title"],children:[e.jsx("div",{className:n.text,children:c.title}),h===!1&&x.is_free!==1&&c.free_seconds>0&&e.jsx("div",{className:n.free,children:"试看"})]}),e.jsx("div",{className:n["video-duration"],children:e.jsx(V,{seconds:c.duration})})]},c.id))})]},d.id)),u[0]&&u[0].length>0&&e.jsxs("div",{className:n["chapter-item"],children:[e.jsx("div",{className:n["chapter-name"],children:"无章节内容"}),e.jsx("div",{className:n["chapter-videos-box"],children:u[0].map(d=>e.jsxs("div",{className:n["video-item"],onClick:()=>_(d),children:[!h&&x.is_free!==1&&e.jsx("img",{className:n["play-icon"],src:$}),e.jsxs("div",{className:n["video-title"],children:[e.jsx("div",{className:n.text,children:d.title}),h===!1&&x.is_free!==1&&d.free_seconds>0&&e.jsx("div",{className:n.free,children:"试看"})]}),e.jsx("div",{className:n["video-duration"],children:e.jsx(V,{seconds:d.duration})})]},d.id))})]})]}),cs=()=>{const l=Q(),x=new URLSearchParams(Ce().search),u=ke(),[h,j]=o.useState(!1),[_,d]=o.useState(!1),[c,C]=o.useState(Number(u.courseId)),[t,S]=o.useState({}),[b,I]=o.useState([]),[r,X]=o.useState([]),[v,Z]=o.useState(!1),[w,F]=o.useState(!1),[D,ee]=o.useState({}),[M,se]=o.useState([]),[te,R]=o.useState([]),[ae,H]=o.useState({}),[i,oe]=o.useState({}),[ie,U]=o.useState(!1),[g,ce]=o.useState({}),[P,ne]=o.useState(!1),[f,de]=o.useState(Number(x.get("tab"))||2),[le,z]=o.useState(!1),E=k(s=>s.systemConfig.value.configFunc),re=k(s=>s.systemConfig.value.config),p=k(s=>s.loginUser.value.isLogin),O=[{name:"课程详情",id:2},{name:"课程目录",id:3},{name:"课程评论",id:4},{name:"课程附件",id:5}];o.useEffect(()=>(me(),G(),window.addEventListener("scroll",A,!0),()=>{window.removeEventListener("scroll",A,!0)}),[c]),o.useEffect(()=>{Se(document.getElementById("desc")),we(document.getElementById("desc"))},[document.getElementById("desc")]);const q=s=>{de(s),l("/courses/detail/"+c+"?tab="+s)},A=()=>{let s=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,T=document.querySelector("#NavBar");if(T){let be=T.offsetTop;s>be?z(!0):z(!1)}},me=()=>{h||(j(!0),Ie(c).then(s=>{document.title=s.data.course.title,S(s.data.course),I(s.data.attach),X(s.data.chapters),Z(s.data.isBuy),F(s.data.isCollect),ee(s.data.videos),se(s.data.buyVideos),!s.data.isBuy&&E.miaosha?he():!s.data.isBuy&&E.tuangou&&K(),j(!1)}))},G=()=>{_||(d(!0),De(c).then(s=>{R(s.data.comments),H(s.data.users),d(!1)}))},ue=()=>{d(!1),R([]),H({})},J=()=>{p?Ee(c).then(()=>{F(!w),w?B.success("取消收藏"):B.success("已收藏")}):N()},N=()=>{let s=encodeURIComponent(window.location.pathname+window.location.search);l("/login?redirect="+s)},he=()=>{t.is_free!==1&&Ve(0,{course_id:c,course_type:"course"}).then(s=>{oe(s.data),!s.data.data&&!v&&E.tuangou&&K()})},K=()=>{t.is_free!==1&&$e(0,{course_id:c,course_type:"course"}).then(s=>{ce(s.data),ne(s.data.join_item&&s.data.join_item.length!==0)})},_e=()=>{l("/vip")},ge=()=>{if(!p){N();return}l("/order?goods_id="+c+"&goods_type=vod&goods_charge="+t.charge+"&goods_label=点播课程&goods_name="+t.title+"&goods_thumb="+t.thumb)},xe=s=>{l("/order?course_id="+i.data.goods_id+"&course_type="+i.data.goods_type+"&goods_type=ms&goods_charge="+i.data.charge+"&goods_label=秒杀&goods_name="+i.data.goods_title+"&goods_id="+s+"&goods_thumb="+i.data.goods_thumb)},ve=(s=0)=>{if(!p){N();return}l("/order?course_id="+g.goods.other_id+"&course_type="+g.goods.goods_type+"&goods_type=tg&goods_charge="+g.goods.charge+"&goods_label=团购&goods_name="+g.goods.goods_title+"&goods_id="+g.goods.id+"&goods_thumb="+g.goods.goods_thumb+"&tg_gid="+s)},fe=()=>{if(!p){N();return}U(!0)},Y=s=>{if(!p){N();return}l("/courses/video/"+s.id)},je=s=>{let T=Le();if(!p){N();return}if(!v){B.error("请购买课程后下载");return}window.open(`${re.url}/api/v2/course/attach/${s}/download?token=${T}`)};return e.jsxs(e.Fragment,{children:[le&&e.jsx("div",{className:"fix-nav",children:e.jsx("div",{className:"course-tabs",children:O.map(s=>e.jsxs("div",{className:f===s.id?"active item-tab":"item-tab",onClick:()=>q(s.id),children:[s.name,f===s.id&&e.jsx("div",{className:"actline"})]},s.id))})}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"bread-nav",children:[h&&e.jsx(L.Button,{active:!0,style:{width:1200,height:14,marginLeft:0}}),!h&&e.jsxs(e.Fragment,{children:[e.jsx("a",{onClick:()=>{l("/")},children:"首页"})," ","/",e.jsx("a",{onClick:()=>{l("/courses")},children:"录播课"})," ","/",e.jsx("span",{children:t.title})]})]}),e.jsx(Ue,{id:t.id,title:t.title,type:"vod"}),!v&&i&&e.jsx(Fe,{open:ie,msData:i,onCancel:()=>U(!1)}),e.jsxs("div",{className:a["course-info"],children:[e.jsxs("div",{className:a["course-info-box"],children:[e.jsxs("div",{className:a["course-thumb"],children:[h&&e.jsx(L.Button,{active:!0,style:{width:320,height:240,borderRadius:8}}),e.jsx(He,{value:t.thumb,width:320,height:240,border:null})]}),e.jsxs("div",{className:a.info,children:[h&&e.jsxs("div",{style:{width:710,display:"flex",flexDirection:"column"},children:[e.jsx(L.Button,{active:!0,style:{width:710,height:30,marginTop:20}}),e.jsx(L.Button,{active:!0,style:{width:710,height:16,marginTop:21}})]}),e.jsx("div",{className:a["course-info-title"],children:t.title}),w&&e.jsx("img",{onClick:()=>{J()},className:a["collect-button"],src:Pe}),!w&&e.jsx("img",{onClick:()=>{J()},className:a["collect-button"],src:ze}),e.jsx("p",{className:a.desc,children:t.short_description}),e.jsxs("div",{className:a["btn-box"],children:[!v&&t.charge!==0&&e.jsxs(e.Fragment,{children:[i&&i.data&&e.jsxs(e.Fragment,{children:[i.order&&i.order.status===0&&e.jsx("div",{className:a["buy-button"],onClick:()=>xe(i.order.id),children:"已获得秒杀资格，请尽快支付"}),(!i.order||i.order.status!==0)&&!i.data.is_over&&e.jsxs("div",{className:a["buy-button"],onClick:()=>fe(),children:["立即秒杀￥",i.data.charge]})]}),(!i||!i.data)&&e.jsxs(e.Fragment,{children:[P&&e.jsx("div",{className:a["has-button"],children:"正在拼团中"}),!P&&t.charge>0&&e.jsxs("div",{className:a["buy-button"],onClick:()=>ge(),children:["订阅课程￥",t.charge]}),t.vip_can_view===1&&!Te.disable_vip&&e.jsx("div",{className:a["role-button"],onClick:()=>_e(),children:"会员免费看"}),g&&g.goods&&(!g.join_item||g.join_item.length===0)&&e.jsxs("div",{className:a["role-button"],onClick:()=>ve(0),children:["单独开团￥",g.goods.charge]})]})]}),t.is_free===1&&e.jsx("div",{className:a["has-button"],children:"本课程免费"}),t.is_free!==1&&v&&e.jsx("div",{className:a["has-button"],children:"课程已购买"})]})]})]}),!v&&i&&e.jsx(Me,{msData:i}),!v&&i&&e.jsx(Re,{tgData:g}),e.jsx("div",{className:"course-tabs",id:"NavBar",children:O.map(s=>e.jsxs("div",{className:f===s.id?"active item-tab":"item-tab",onClick:()=>q(s.id),children:[s.name,f===s.id&&e.jsx("div",{className:"actline"})]},s.id))})]}),f===2&&e.jsx("div",{className:a["coursr-desc"],children:e.jsx("div",{className:"u-content md-content",id:"desc",dangerouslySetInnerHTML:{__html:t.render_desc}})}),f===3&&e.jsxs("div",{className:a["course-chapter-box"],children:[r.length>0&&e.jsx(Qe,{chapters:r,course:t,videos:D,isBuy:v,buyVideos:M,switchVideo:s=>Y(s)}),r.length===0&&D[0]&&e.jsx(Ke,{course:t,videos:D[0],isBuy:v,buyVideos:M,switchVideo:s=>Y(s)})]}),f===4&&e.jsx(Oe,{cid:c,isBuy:v,comments:te,commentUsers:ae,success:()=>{ue(),G()}}),f===5&&e.jsxs("div",{className:a["attach-list-box"],children:[b.length===0&&e.jsx(W,{}),b.length>0&&b.map(s=>e.jsxs("div",{className:a["attach-item"],children:[e.jsx("div",{className:a["attach-name"],children:s.name}),e.jsx("a",{onClick:()=>je(s.id),className:a["download-attach"],children:"下载附件"})]},s.id))]})]})]})};export{cs as default};
