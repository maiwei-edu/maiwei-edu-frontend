import{q as A,Y as x,u as _,p as u,al as I,s,a2 as F,bX as v,ah as V,am as L,I as R,an as T,D as y,t as w,bY as r,v as k,bZ as i}from"./index-c511a629.js";function S(e,c){return A.get("/addons/MiaoSha/api/v1/m/"+e,c)}function q(e,c){return A.post("/addons/MiaoSha/api/v1/m/"+e+"/join",c)}function U(e,c){return A.get("/addons/TuanGou/api/v1/t/"+e,c)}const X=({msData:e,open:c,onCancel:d})=>{const[t]=x.useForm(),o=_(),[z,m]=u.useState(!1),[a,n]=u.useState({key:null,img:null});u.useEffect(()=>{t.setFieldsValue({captcha:""}),c&&l()},[t,c,e]);const l=()=>{I().then(h=>{n(h.data)})},g=h=>{d(),o("/order?course_id="+e.data.goods_id+"&course_type="+e.data.goods_type+"&goods_type=ms&goods_charge="+e.data.charge+"&goods_label=秒杀&goods_name="+e.data.goods_title+"&goods_id="+h+"&goods_thumb="+e.data.goods_thumb)},p=h=>{z||(m(!0),q(e.data.id,{captcha:h.captcha,captcha_key:a.key}).then(f=>{w.success("抢购成功，请尽快支付");let C=f.data.id;m(!1),setTimeout(()=>{g(C)},600)}).catch(f=>{m(!1),t.setFieldsValue({captcha:""}),l()}))},M=h=>{console.log("Failed:",h)};return s.jsx(s.Fragment,{children:c?s.jsxs(F,{title:"",centered:!0,forceRender:!0,open:!0,width:500,onCancel:()=>{d()},maskClosable:!1,closable:!1,footer:null,children:[s.jsxs("div",{className:v.tabs,children:[s.jsx("div",{className:v["tab-active-item"],children:"秒杀活动"}),s.jsx("img",{className:v["btn-close"],onClick:()=>{d()},src:V})]}),s.jsx(x,{form:t,name:"miaosha-dialog",labelCol:{span:0},wrapperCol:{span:24},initialValues:{remember:!0},onFinish:p,onFinishFailed:M,autoComplete:"off",style:{marginTop:30},children:s.jsx(x.Item,{children:s.jsxs(L,{align:"baseline",children:[s.jsx(x.Item,{name:"captcha",rules:[{required:!0,message:"请输入图形验证码!"}],children:s.jsx(R,{style:{width:310,height:54,marginRight:10},autoComplete:"off",placeholder:"请输入图形验证码"})}),s.jsx(T,{onClick:()=>l(),src:a.img,width:110,height:39,preview:!1,style:{cursor:"pointer"}})]})})}),s.jsxs("div",{slot:"footer",style:{display:"flex",flexDirection:"row-reverse"},children:[s.jsx(y,{type:"primary",onClick:()=>t.submit(),loading:z,children:"立即秒杀"}),s.jsx(y,{style:{marginRight:15},onClick:()=>d(),children:"取消"})]})]}):null})};var j=null;const N=({timestamp:e,type:c})=>{const[d,t]=u.useState(0),[o,z]=u.useState({day:0,hr:0,min:0,sec:0});u.useEffect(()=>(t(e),m(e),()=>{j&&clearInterval(j)}),[e]);const m=a=>{let n=a;j=setInterval(()=>{if(n>0){n--;let l=Math.floor(n/3600/24),g=Math.floor(n/3600%24),p=Math.floor(n/60%60),M=Math.floor(n%60);z({day:l,hr:g<10?"0"+g:g,min:p<10?"0"+p:p,sec:M<10?"0"+M:M})}else clearInterval(j)},1e3)};return s.jsxs(s.Fragment,{children:[o.day!==0&&s.jsxs("span",{children:[o.day,"天",o.hr,"时",o.min,"分",o.sec,"秒"]}),c!=="face"&&o.day===0&&o.hr!=="00"&&s.jsxs("span",{children:[o.hr,"时",o.min,"分",o.sec,"秒"]}),c!=="face"&&o.day===0&&o.hr==="00"&&s.jsxs("span",{children:[o.min,"分",o.sec,"秒"]}),c==="face"&&o.day===0&&o.hr==="00"&&o.min==="00"&&o.sec==="00"&&s.jsx("span",{children:"请刷新界面重试"})]})},K=({msData:e})=>s.jsx(s.Fragment,{children:e.data&&s.jsx("div",{className:r["ms-comp"],children:s.jsxs("div",{className:r["ms-content"],children:[s.jsx("div",{className:r["sp-mask"]}),s.jsx("div",{className:r["sp-transform"]}),s.jsxs("div",{className:r.original_charge,children:["原价￥",e.data.original_charge]}),s.jsxs("div",{className:r.charge,children:[s.jsx("span",{className:r["ms-text"],children:"限时秒杀价:"}),s.jsxs("span",{className:r["charge-text"],children:[s.jsx("span",{className:r.unit,children:"￥"}),e.data.charge]})]}),e.data.is_over&&s.jsx("div",{className:r.price,children:s.jsx("div",{className:r.end,children:"已售罄"})}),e.data.is_start&&s.jsxs("div",{className:r.price,children:[s.jsxs("div",{className:r["ms-time"],children:["距秒杀结束剩余",s.jsx(N,{timestamp:e.data.expired_seconds,type:""})]}),s.jsx("i",{className:r.line}),s.jsxs("div",{className:r["ms-time"],children:["库存剩余",e.data.over_num,"件"]})]})]})})}),b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAMAAADVRocKAAAAAXNSR0IArs4c6QAAARdQTFRFAAAA////////qqqq////zMzM1dXVxsbGxMTEyMjIzMzMzMzMzMzMz8/PzMzMzs7Oy8vLzc3Nzs7OzMzMzs7Oy8vLz8/PzMzMzc3Nzs7Ozs7Oy8vLzc3Nzs7Ozc3Nzc3Nzs7Ozc3Ny8vLzs7Ozs7OzMzMzc3Nzs7Ozs7OzMzMzMzMzc3Nzs7OzMzMzs7Ozc3NzMzMzMzMzc3NzMzMzMzMzc3NzMzMzMzMzs7OzMzMy8vLzc3Nzc3Nzc3Ny8vLzMzMzc3Nzc3NzMzMy8vLzMzMzMzMzMzMzMzMzMzMzc3NzMzMzMzMzMzMzMzMzMzMy8vLzMzMzMzMzMzMzMzMzMzMzMzMzMzMy8vLzMzMzc3NzMzMzc3NzMzM6RMN0wAAAFx0Uk5TAAECAwMFBgkNDg8UGSAoKiwzNDc5Ozs8QkNERUhJTE1OUVRYWVpbYmNkaWtteYGJjI2OkJGVlpubnKiorLa3v8DHyc/P0tPX2Nrb3uTq7O3t7/L19vn7/P39/v5UybO+AAADtklEQVRo3r1a2VrqMBAeAQ8gyirgQRZBFgHZQUQEQVwOxQUFwYX3f45zQRNaWuiWca7ytZN/kqb5ZzITAFVi86SK7T73OpnPJ69cv11MeWzASuzRyuBzIZHPQSVqN46+d9abLTbKrHe2ZwR9J3I1XSjI9CqyoxPenHxYqJKHpFkHvCUzXKiWYcaiFf/wbqFJ7g41wTtaXwuN8tVyqMc/eZH2H3VruXjI53L5QvFcrTuSjuDlRCX8bvV7revjRUIyPEfi4nFN7bu6qwb/4Fbc7ank3qTqLj2JdW8PlPG9z6IuN2HTNm1T+Eak/uxVwj9+F6j/dALKIwp0fgRd3o+3a59+CD/9kbpFOxIuxsfpVnwBqU0Kf9T+dX8KEwEJbrFwLBj/vVPLxnHeC+aw8St5Bd//0qpt51svBeuwYaUPVv/PLKudvLIrWn+W/Vt3V///NKaHfWMrar+V23FV+votqI/fg28UoirDP5QfpkG9DipI5/At4SUH5bdZDHRLjK7Dyzp5tejssmBAshSmteZfKPs2jQUJTcrvIg9kof7r3mrMgJXuuDuhF81QfnCCQXFS1sgI4geOPCwYj6QKBItbxRpJyp/b+W2/XK/X6+X97cxHuTVJ4ysS//wo8HN+qZZXYG/iHx5IRBYhJjsKsz9fqp0rqHUIXoR/0CYP/GwM+Alem49vyQa/ATYGgPjp6Z5494VZGQiLWaFH4hMTKwMmEs30AADshKBKwMoAlAhx2gEgSubjZmfATTCjAFAhmwzYGQCy2SoAMODbDZYGGjzoAMBGiDrB0kCCBEk28BL+drA04CDD9kCab42ApQEY8bBpKPKtLlsDXR62SImoxtZAjdJRn2/l2BrI8bB9IM4sLuNf8udiuV6qXq89zst4oDhxazDmWyGpUlntCbMs7RviX42B+GifVKmu1kBd2tdHogiY8y0XWwMu/tUc3wD6J0Je5Ff83xR9o6FTBTrZpXDpOgUebIdj+0R2mThO/2Ll9HHCln+CsAU98EIPHdGDX8zw/ex3DiCrI1SAjYEAwbv6rUMg42PsX8kxFv0gDuYhRiphaP69ZAh+OoddQupSPiGFn1LDTwqipzXxE7P4qWX05Lg4vd/Umt5vKqf38QsU+CUW/CKRpMzlV4b3aypz4Rfq8EuNssXShlyxtKGzWAro5V7AL1gDeskdACwZTj08p/3SAKBfewAA2Im0lS9utHVf3FhGxtntV0+yhq6eLAX38gwvNm+62O5z48l8Phlz/XYx7VV5/ec/Vhzfqa3GnUUAAAAASUVORK5CYII=",P=({tgData:e})=>{const c=_(),d=k(a=>a.loginUser.value.isLogin),t=a=>{let n=[];for(let l=0;l<a;l++)n.push(l+1);return n},o=()=>{let a=encodeURIComponent(window.location.pathname+window.location.search);c("/login?redirect="+a)},z=()=>{if(!d){o();return}var a=document.createElement("input");a.value=window.location.href,document.body.appendChild(a),a.select(),document.execCommand("Copy"),document.body.removeChild(a),w.success("链接已复制，可分享邀请好友参团")},m=(a=0)=>{if(!d){o();return}c("/order?course_id="+e.goods.other_id+"&course_type="+e.goods.goods_type+"&goods_type=tg&goods_charge="+e.goods.charge+"&goods_label=团购&goods_name="+e.goods.goods_title+"&goods_id="+e.goods.id+"&goods_thumb="+e.goods.goods_thumb+"&tg_gid="+a)};return s.jsx(s.Fragment,{children:e.goods&&s.jsxs("div",{className:i["tg-comp"],children:[s.jsxs("div",{className:i["tg-content"],children:[s.jsx("div",{className:i["sp-mask"]}),s.jsx("div",{className:i["sp-transform"]}),s.jsxs("div",{className:i["tg-content-item"],children:[s.jsxs("div",{className:i["original-price"],children:["原价￥",e.goods.original_charge]}),s.jsx("div",{className:i.tip,children:"若拼团失败退款将原路返回，请耐心等待"})]}),s.jsxs("div",{className:i["tg-content-item"],children:[s.jsxs("span",{className:i.price,children:["限时拼团价￥",s.jsx("strong",{children:e.goods.charge})]}),s.jsxs("span",{className:i.time,children:[e.goods.people_num,"人团 距活动结束剩余",s.jsx(N,{timestamp:e.goods.ended_count_down,type:""})]})]})]}),e.items&&e.items.length>0&&s.jsx("div",{className:i["tg-list"],children:e.items.map(a=>s.jsxs("div",{className:i.item,children:[a.create_user_id===0&&s.jsxs("div",{className:i["left-box"],children:[s.jsx("img",{className:i.value,src:a.create_user_avatar}),a.users.map((n,l)=>s.jsx("img",{className:i.value,src:n.avatar},l)),t(e.goods.people_num-1-a.users.length).map(n=>s.jsx("img",{className:i.value,src:b},n+a.users.length+1))]}),a.create_user_id!==0&&s.jsxs("div",{className:i["left-box"],children:[a.users.map((n,l)=>s.jsx("img",{className:i.value,src:n.avatar},l)),t(e.goods.people_num-a.users.length).map(n=>s.jsx("img",{className:i.value,src:b},n+a.users.length+1))]}),s.jsxs("div",{className:i["right-box"],children:[s.jsxs("div",{className:i.date,children:["差",s.jsx("span",{children:a.over_people_num}),"人拼成 剩余",s.jsx(N,{timestamp:a.count_down,type:""},a.id)]}),e.join_item&&e.join_item.length!==0&&s.jsxs(s.Fragment,{children:[e.join_item.id===a.id&&s.jsx("div",{className:i.button,onClick:()=>z(),children:"拼团中，邀请好友参团"}),e.join_item.id!==a.id&&s.jsx("div",{className:i["no-join-button"],children:"加入拼团"})]}),(!e.join_item||e.join_item.length===0)&&s.jsx("div",{className:i.button,onClick:()=>m(a.id),children:"加入拼团"})]})]},a.id))})]})})};export{X as M,P as T,U as a,K as b,S as d};
