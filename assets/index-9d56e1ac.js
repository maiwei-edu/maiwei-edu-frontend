import{u as O,s as e,cy as p,ad as ne,p as n,v as $,aw as ie,aB as ce,J as re,K as le,t as g,cz as t,ah as oe,I as A,D as Q,y as de,x as ue,S as B,z as M,cA as me}from"./index-e91a7de6.js";import{q as ge,c as he,u as xe,s as pe,l as K,a as je}from"./upload-525b6350.js";import{E as fe}from"./index-155c943d.js";import{F as ve}from"./index-3ecd6092.js";import{F as Ne}from"./index-4bfdb87b.js";import{U as G}from"./index-27183a1b.js";import{P as ye}from"./Pagination-ac88559c.js";import"./useForceUpdate-92b38596.js";const _e=({cid:r,title:o,credit1:N,statusText:y,status:C,viewTimes:h,answerCount:u,voteCount:I})=>{const b=O(),x=()=>{b("/wenda/detail/"+r)};return e.jsxs("div",{className:p["qa-item-comp"],onClick:()=>x(),children:[e.jsx("div",{className:p.icon,children:e.jsx("img",{src:ge})}),C===1&&e.jsx("div",{className:p["status-label"],children:y}),e.jsxs("div",{className:p.body,children:[e.jsx("div",{className:p.title,children:o}),e.jsxs("div",{className:p.stat,children:[e.jsxs("span",{className:p["answer-count"],children:[u,"个回答"]}),e.jsxs("span",{className:p["view-times"],children:[h,"次浏览"]}),N>0&&e.jsxs("span",{className:p["credit1-label"],children:[N,"积分"]})]})]})]})},be=({open:r,enable:o,onSuccess:N,onCancel:y})=>{const C=ne(),[h,u]=n.useState(!1),[I,b]=n.useState([]),[x,q]=n.useState(""),[j,w]=n.useState(null),[m,E]=n.useState(0),[f,L]=n.useState(""),[v,U]=n.useState([]),D=$(a=>a.loginUser.value.user);n.useEffect(()=>{r&&(q(""),w(null),U([]),E(0),L(""),P(),k())},[r]);const k=()=>{ie().then(a=>{let c=a.data;C(ce(c))})},P=()=>{he().then(a=>{b(a.data.categories)})},z={name:"file",multiple:!1,method:"POST",action:re.app_url+"/api/v2/upload/image",headers:{Accept:"application/json",authorization:"Bearer "+le()},beforeUpload:a=>{const c=a.type==="image/png"||a.type==="image/jpg"||a.type==="image/jpeg";c||g.error(`${a.name}不是图片文件`);const d=a.size/1024/1024<2;return d||g.error("图片大小不超过2M"),c&&d||G.LIST_IGNORE},onChange(a){const{status:c,response:d}=a.file;if(c==="done")if(d.code===0){g.success("上传成功");let R=d.data.url,l=[...v];l.push(R),U(l)}else g.error(d.msg);else c==="error"&&g.error(`${a.file.name} 上传失败`)}},F=()=>{if(h)return;if(m===0){g.error("请选择问题分类");return}if(x===""){g.error("请填写问题标题");return}if(f===""){g.error("请填写问题具体内容");return}let a=Math.floor(j);if(a>0&&a>D.credit1){g.error("积分余额不足");return}u(!0),pe({title:x,category_id:m,original_content:f,render_content:f,images:v,credit1:j}).then(c=>{g.success("发布成功"),u(!1),N(c.data.id,j||0)}).catch(c=>{u(!1)})};return e.jsx(e.Fragment,{children:r&&e.jsx("div",{className:t.mask,children:e.jsxs("div",{className:t["dialog-box"],children:[e.jsxs("div",{className:t.tabs,children:[e.jsxs("div",{className:t.tit,children:["问题分类",e.jsx("span",{className:t.notice_article_type,children:"*"})]}),e.jsx("img",{className:t["btn-close"],onClick:()=>y(),src:oe})]}),e.jsxs("div",{className:t["qa-group-input-box"],children:[e.jsx("div",{className:t["qa-group-item"],children:e.jsx("div",{className:t["body-wrap"],children:I.map(a=>e.jsx("div",{className:a.id===m?t["active-category"]:t.category,onClick:()=>E(a.id),children:a.name},a.id))})}),e.jsx("div",{className:t["qa-group-item"],children:e.jsxs("div",{className:t.body,children:[e.jsxs("div",{className:t.title,children:["问题标题",e.jsx("span",{className:t.notice_article_type,children:"*"})]}),e.jsx(A,{value:x,onChange:a=>{q(a.target.value)},className:t.input,maxLength:64,placeholder:"请填写问题标题（不超过64个字）"})]})}),e.jsx("div",{className:t["qa-group-item"],children:e.jsxs("div",{className:t.body,children:[e.jsxs("div",{className:t.title,children:["问题内容",e.jsx("span",{className:t.notice_article_type,children:"*"})]}),e.jsx(A.TextArea,{value:f,onChange:a=>{L(a.target.value)},className:t.textarea,placeholder:"请填写问题具体内容"})]})}),e.jsx("div",{className:t["qa-group-item"],children:e.jsxs("div",{className:t.body,children:[e.jsx("div",{className:t.title,children:"插入图片"}),e.jsxs("div",{className:t["img-wrap"],children:[e.jsx(G,{...z,showUploadList:!1,children:e.jsx("div",{className:t["btn-upload-image"],children:e.jsx("img",{src:xe})})}),v.length>0&&v.map((a,c)=>e.jsx("div",{className:t["img-item"],children:e.jsx("img",{src:a})},c))]})]})})]}),e.jsx("div",{className:t["bottom-item"],children:e.jsxs("div",{className:t.body,children:[o&&e.jsx("div",{className:t.title,children:"悬赏积分"}),e.jsxs("div",{className:t.credit1,children:[o&&e.jsxs(e.Fragment,{children:[e.jsx(A,{type:"number",value:j,onChange:a=>{w(a.target.value)},className:t.input2,placeholder:"置悬赏积分"}),e.jsxs("div",{className:t.help,children:["积分余额：",D.credit1,"积分"]})]}),f.length>0&&x.length>0&&m>0?e.jsx(Q,{loading:h,className:t["active-confirm-button"],onClick:()=>F(),children:"发布问题"}):e.jsx("div",{className:t["confirm-button"],children:"发布问题"})]})]})})]})})})},Se="_contanier_gankd_1",Ce="_cont_gankd_1",_={contanier:Se,"qa-box":"_qa-box_gankd_9","right-contanier":"_right-contanier_gankd_17",cont:Ce,"create-button":"_create-button_gankd_34","wenda-tips":"_wenda-tips_gankd_50"},Ee=()=>{document.title="在线问答";const r=O(),[o,N]=n.useState(!1),[y,C]=n.useState(!0),[h,u]=n.useState([]),[I,b]=n.useState([]),[x,q]=n.useState(!1),[j,w]=n.useState(1),[m,E]=n.useState(16),[f,L]=n.useState(0),[v,U]=n.useState(""),[D,k]=n.useState(!1),[P,z]=n.useState(!1),[F,a]=n.useState(!1),c=new URLSearchParams(de().search),[d,R]=n.useState(c.get("scene")||"default"),[l,H]=n.useState(Number(c.get("cid"))||0),[S,J]=n.useState(Number(c.get("child"))||0),V=$(s=>s.loginUser.value.user),W=$(s=>s.loginUser.value.isLogin),X=[{id:"default",name:"综合"},{id:"solved",name:"已解决"},{id:"unsolved",name:"未解决"},{id:"last_answer",name:"最新回答"}];n.useEffect(()=>{se()},[]),n.useEffect(()=>{Y()},[x,j,m]);const Y=()=>{if(o)return;N(!0);let s=0;S===0||l==0?s=l:s=S,K({page:j,size:m,scene:d,cid:s}).then(i=>{b(i.data.categories),u(i.data.data.data),L(i.data.data.total),N(!1),z(!0)})},Z=()=>{w(1),u([]),q(!x)},ee=s=>{u([]);let i=0;S===0||l==0?i=l:i=S,K({page:1,size:m,scene:s,cid:i}).then(T=>{b(T.data.categories),u(T.data.data.data),L(T.data.data.total)})},se=()=>{je().then(s=>{U(s.data.pc_diy_content),s.data.enable_credit1===1?a(!0):a(!1),C(!1)})},te=()=>{let s=encodeURIComponent(window.location.pathname+window.location.search);r("/login?redirect="+s)},ae=(s,i)=>{k(!1);let T=Number(V.credit1)-Number(i);me(T),setTimeout(()=>{r("/wenda/detail/"+s)},600)};return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{loading:o,categories:I,defaultKey:l,defaultChild:S,onSelected:(s,i)=>{H(s),J(i),r(s===0?"/wenda?scene="+d:i===0?"/wenda?cid="+l+"&scene="+d:"/wenda?cid="+l+"&child="+i+"&scene="+d),Z()}}),e.jsx(ve,{scenes:X,defaultKey:"default",onSelected:s=>{R(s),r(l===0?"/wenda?scene="+s:"/wenda?cid="+l+"&child="+S+"&scene="+s),ee(s)}}),e.jsx(be,{open:D,enable:F,onCancel:()=>k(!1),onSuccess:(s,i)=>ae(s,i)}),e.jsxs("div",{className:_.contanier,children:[e.jsxs("div",{className:_["qa-box"],children:[o&&e.jsx(ue,{children:e.jsx("div",{style:{width:769,display:"flex",flexDirection:"column"},children:Array.from({length:10}).map((s,i)=>e.jsx("div",{style:{width:769,height:134,display:"flex",flexDirection:"row",padding:"4px 20px 20px 20px",boxSizing:"border-box",marginBottom:10},children:e.jsx(B,{active:!0,paragraph:{rows:1}})},i))})}),!o&&h.length===0&&e.jsx(M,{span:24,children:e.jsx(fe,{})}),!o&&h.length>0&&e.jsx("div",{className:_["list-box"],children:h.map(s=>e.jsx(_e,{cid:s.id,credit1:s.credit1,statusText:s.status_text,status:s.status,title:s.title,viewTimes:s.view_times,answerCount:s.answer_count,voteCount:s.vote_count},s.id))}),!o&&h.length>0&&m<f&&e.jsx(M,{span:24,style:{display:"flex",justifyContent:"center",marginTop:50},children:e.jsx(ye,{onChange:s=>{w(s),window.scrollTo(0,0)},pageSize:m,defaultCurrent:j,total:f})})]}),e.jsx("div",{className:_["right-contanier"],children:e.jsxs("div",{className:_.cont,children:[!y&&P&&e.jsx(Q,{type:"primary",className:_["create-button"],onClick:()=>{if(!W){te();return}k(!0)},children:"我要提问"}),y&&e.jsx(B,{style:{marginTop:30},active:!0,paragraph:{rows:2}}),!y&&e.jsx(e.Fragment,{children:v&&v!==""&&e.jsx("div",{className:_["wenda-tips"],dangerouslySetInnerHTML:{__html:v}})})]})})]})]})};export{Ee as default};
