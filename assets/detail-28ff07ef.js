import{u as A,v as L,p as n,s as e,cv as d,I as me,D as he,E as ge,t as N,y as be,F as _e,G as xe,H as ve,S as B,J as fe}from"./index-d3b20173.js";import{d as je,a as pe,M as ke,b as Ne,T as ye}from"./index-c911ac26.js";import{s as Ce,d as Se,a as Be,b as Le,c as Te}from"./book-c4b95887.js";import{T as we}from"./index-e9655fcb.js";import{H as Ee}from"./index-7f88061e.js";import{E as De}from"./index-ce951dff.js";import{c as Re,n as Fe}from"./icon-collect-n-7dad1c8c.js";const Me=({bid:u,isBuy:T,comments:x,commentUsers:h,success:y})=>{const w=A(),v=L(a=>a.loginUser.value.user),l=L(a=>a.loginUser.value.isLogin),[f,o]=n.useState(""),[C,g]=n.useState(!1),S=()=>{C||f!==""&&(g(!0),Ce(u,{content:f}).then(()=>{N.success("成功"),o(""),g(!1),y()}).catch(a=>{g(!1)}))};return e.jsxs("div",{className:d["course-comments-box"],children:[e.jsx("div",{className:d["comment-divider"],children:"全部评论"}),e.jsx("div",{className:d.line}),l&&T&&e.jsx("div",{className:d.replybox,children:e.jsxs("div",{className:d.reply,children:[e.jsx("img",{className:d["user-avatar"],src:v.avatar}),e.jsx(me,{value:f,onChange:a=>{o(a.target.value)},style:{width:960,height:48,marginRight:30,fontSize:16},placeholder:"此处填写你的评论"}),e.jsx(he,{type:"primary",disabled:f.length===0,style:{width:72,height:48,fontSize:16,border:"none"},onClick:()=>{S()},loading:C,children:"评论"})]})}),!l&&e.jsx("div",{className:d.replybox,children:e.jsx("div",{className:d.text,onClick:()=>w("/login"),children:"未登录，请登录后再评论"})}),e.jsxs("div",{className:d["comment-top"],children:[x.length===0&&e.jsx(De,{}),x.length>0&&x.map(a=>e.jsxs("div",{className:d["comment-item"],children:[e.jsx("div",{className:d["user-avatar"],children:e.jsx("img",{src:h[a.user_id].avatar})}),e.jsxs("div",{className:d["comment-content"],children:[e.jsxs("div",{className:d["comment-info"],children:[e.jsx("div",{className:d.nickname,children:h[a.user_id].nick_name}),e.jsx("div",{className:d["comment-time"],children:ge(a.created_at)})]}),e.jsx("div",{className:d["comment-text"],children:a.content})]})]},a.id))]})]})},He="_status_1duhs_24",Ie="_info_1duhs_34",Ue="_desc_1duhs_61",Pe="_text_1duhs_199",$e="_free_1duhs_207",t={"book-info":"_book-info_1duhs_1","book-info-box":"_book-info-box_1duhs_7","book-thumb":"_book-thumb_1duhs_16",status:He,info:Ie,"book-info-title":"_book-info-title_1duhs_40","collect-button":"_collect-button_1duhs_53",desc:Ue,"btn-box":"_btn-box_1duhs_78","see-button":"_see-button_1duhs_88","buy-button":"_buy-button_1duhs_102","role-button":"_role-button_1duhs_116","book-desc":"_book-desc_1duhs_132","book-chapter-box":"_book-chapter-box_1duhs_143","chapter-item":"_chapter-item_1duhs_150","chapter-name":"_chapter-name_1duhs_158","chapter-videos-box":"_chapter-videos-box_1duhs_176","book-itemsp":"_book-itemsp_1duhs_180","video-title":"_video-title_1duhs_194",text:Pe,free:$e,"video-info":"_video-info_1duhs_220","book-item":"_book-item_1duhs_180"},Ye=()=>{const u=A(),T=new URLSearchParams(be().search),x=_e(),[h,y]=n.useState(!1),[w,v]=n.useState(!1),[l,f]=n.useState(Number(x.courseId)),[o,C]=n.useState({}),[g,S]=n.useState(!1),[a,G]=n.useState(!1),[_,J]=n.useState([]),[m,Y]=n.useState({}),[i,K]=n.useState({}),[Q,R]=n.useState(!1),[r,W]=n.useState({}),[F,X]=n.useState(!1),[Z,M]=n.useState([]),[ee,H]=n.useState({}),[b,se]=n.useState(Number(T.get("tab"))||2),[te,I]=n.useState(!1),E=L(s=>s.systemConfig.value.configFunc),j=L(s=>s.loginUser.value.isLogin),U=[{name:"详情",id:2},{name:"目录",id:3},{name:"评论",id:4}];n.useEffect(()=>(oe(),P(),ae(),window.addEventListener("scroll",O,!0),()=>{window.removeEventListener("scroll",O,!0)}),[l]),n.useEffect(()=>{xe(document.getElementById("desc")),ve(document.getElementById("desc"))},[document.getElementById("desc")]);const oe=()=>{h||(y(!0),Se(l).then(s=>{document.title=s.data.book.name,C(s.data.book);let c=s.data.chapters,k=s.data.articles;c.length>0&&k[0]&&k[0].length>0&&c.push({id:0,name:"无章节内容",sort:1e4}),J(c),Y(k),G(s.data.is_buy),!s.data.is_buy&&E.miaosha?ne():!s.data.is_buy&&E.tuangou&&$(),y(!1)}))},ae=()=>{Be({id:l,type:"book"}).then(s=>{S(s.data.like)})},P=()=>{w||(v(!0),Le(l,{page:1,size:1e4}).then(s=>{M(s.data.data.data),H(s.data.users),v(!1)}))},ie=()=>{v(!1),M([]),H({})},ne=()=>{o.charge!==0&&je(0,{course_id:l,course_type:"book"}).then(s=>{K(s.data),!s.data.data&&!a&&E.tuangou&&$()})},$=()=>{o.charge!==0&&pe(0,{course_id:l,course_type:"book"}).then(s=>{W(s.data),X(s.data.join_item&&s.data.join_item.length!==0)})},z=s=>{se(s),u("/book/detail/"+l+"?tab="+s)},p=()=>{let s=encodeURIComponent(window.location.pathname+window.location.search);u("/login?redirect="+s)},O=()=>{let s=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,c=document.querySelector("#NavBar");if(c){let k=c.offsetTop;s>k?I(!0):I(!1)}},de=s=>{u("/order?course_id="+i.data.goods_id+"&course_type="+i.data.goods_type+"&goods_type=ms&goods_charge="+i.data.charge+"&goods_label=秒杀&goods_name="+i.data.goods_title+"&goods_id="+s+"&goods_thumb="+i.data.goods_thumb)},ce=()=>{if(!j){p();return}R(!0)},le=()=>{u("/vip")},V=()=>{j?Te({id:l,type:"book"}).then(s=>{S(!g),g?N.success("取消收藏"):N.success("已收藏")}):p()},D=s=>{if(!j){p();return}if(o.charge>0&&s.charge>0&&a===!1){q();return}u("/book/read/"+s.id)},re=()=>{if(m.length===0){N.error("当前电子书下暂无文章");return}let s=null;if(_.length===0)s=m[0][0];else for(let c=0;c<_.length&&(s=m[_[c].id][0],!s);c++);if(!s){N.error("当前电子书下暂无文章");return}D(s)},q=()=>{if(!j){p();return}u("/order?goods_id="+l+"&goods_type=book&goods_charge="+o.charge+"&goods_label=电子书&goods_name="+o.name+"&goods_thumb="+o.thumb)},ue=(s=0)=>{if(!j){p();return}u("/order?course_id="+r.goods.other_id+"&course_type="+r.goods.goods_type+"&goods_type=tg&goods_charge="+r.goods.charge+"&goods_label=团购&goods_name="+r.goods.goods_title+"&goods_id="+r.goods.id+"&goods_thumb="+r.goods.goods_thumb+"&tg_gid="+s)};return e.jsxs(e.Fragment,{children:[te&&e.jsx("div",{className:"fix-nav",children:e.jsx("div",{className:"course-tabs",children:U.map(s=>e.jsxs("div",{className:b===s.id?"active item-tab":"item-tab",onClick:()=>z(s.id),children:[s.name,b===s.id&&e.jsx("div",{className:"actline"})]},s.id))})}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"bread-nav",children:[h&&e.jsx(B.Button,{active:!0,style:{width:1200,height:14,marginLeft:0}}),!h&&e.jsxs(e.Fragment,{children:[e.jsx("a",{onClick:()=>{u("/")},children:"首页"})," ","/",e.jsx("a",{onClick:()=>{u("/book")},children:"电子书"})," ","/",e.jsx("span",{children:o.name})]})]}),e.jsx(Ee,{id:o.id,title:o.name,type:"book"}),!a&&i&&e.jsx(ke,{open:Q,msData:i,onCancel:()=>R(!1)}),e.jsxs("div",{className:t["book-info"],children:[e.jsxs("div",{className:t["book-info-box"],children:[e.jsxs("div",{className:t["book-thumb"],children:[h&&e.jsx(B.Button,{active:!0,style:{width:240,height:320,borderRadius:8}}),e.jsx(we,{value:o.thumb,width:240,height:320,border:null})]}),e.jsxs("div",{className:t.info,children:[h&&e.jsxs("div",{style:{width:710,display:"flex",flexDirection:"column"},children:[e.jsx(B.Button,{active:!0,style:{width:710,height:30,marginTop:20}}),e.jsx(B.Button,{active:!0,style:{width:710,height:16,marginTop:21}})]}),e.jsx("div",{className:t["book-info-title"],children:o.name}),g&&e.jsx("img",{onClick:()=>{V()},className:t["collect-button"],src:Re}),!g&&e.jsx("img",{onClick:()=>{V()},className:t["collect-button"],src:Fe}),e.jsx("p",{className:t.desc,children:o.short_desc}),e.jsxs("div",{className:t["btn-box"],children:[a&&e.jsx("div",{className:t["see-button"],onClick:()=>re(),children:"开始阅读"}),!a&&o.charge!==0&&e.jsxs(e.Fragment,{children:[i&&i.data&&e.jsxs(e.Fragment,{children:[i.order&&i.order.status===0&&e.jsx("div",{className:t["buy-button"],onClick:()=>de(i.order.id),children:"已获得秒杀资格，请尽快支付"}),(!i.order||i.order.status!==0)&&!i.data.is_over&&e.jsxs("div",{className:t["buy-button"],onClick:()=>ce(),children:["立即秒杀￥",i.data.charge]})]}),(!i||!i.data)&&e.jsxs(e.Fragment,{children:[F&&e.jsx("div",{className:t["has-button"],children:"正在拼团中"}),!F&&o.charge>0&&e.jsxs("div",{className:t["buy-button"],onClick:()=>q(),children:["订阅电子书￥",o.charge]}),o.charge>0&&o.is_vip_free===1&&!fe.disable_vip&&e.jsx("div",{className:t["role-button"],onClick:()=>le(),children:"会员免费看"}),r&&r.goods&&(!r.join_item||r.join_item.length===0)&&e.jsxs("div",{className:t["role-button"],onClick:()=>ue(0),children:["单独开团￥",r.goods.charge]})]})]})]})]})]}),!a&&i&&e.jsx(Ne,{msData:i}),!a&&i&&e.jsx(ye,{tgData:r}),e.jsx("div",{className:"course-tabs",id:"NavBar",children:U.map(s=>e.jsxs("div",{className:b===s.id?"active item-tab":"item-tab",onClick:()=>z(s.id),children:[s.name,b===s.id&&e.jsx("div",{className:"actline"})]},s.id))})]}),b===2&&e.jsx("div",{className:t["book-desc"],children:e.jsx("div",{className:"u-content md-content",id:"desc",dangerouslySetInnerHTML:{__html:o.render_desc}})}),b===3&&e.jsxs("div",{className:t["book-chapter-box"],children:[_.length>0&&_.map(s=>e.jsxs("div",{className:t["chapter-item"],children:[e.jsx("div",{className:t["chapter-name"],children:s.name}),m[s.id]&&m[s.id].length>0&&e.jsx("div",{className:t["chapter-videos-box"],children:m[s.id].map(c=>e.jsx("div",{className:t["book-item"],onClick:()=>D(c),children:e.jsxs("div",{className:t["video-title"],children:[e.jsx("div",{className:t.text,children:c.title}),!a&&o.charge>0&&c.charge===0&&e.jsx("div",{className:t.free,children:"试读"})]})},c.id))})]},s.id)),_.length===0&&m[0]&&m[0].length>0&&e.jsx("div",{className:t["chapter-item"],children:e.jsx("div",{className:t["chapter-videos-box"],children:m[0].map(s=>e.jsx("div",{className:t["book-itemsp"],onClick:()=>D(s),children:e.jsxs("div",{className:t["video-title"],children:[e.jsx("div",{className:t.text,children:s.title}),!a&&o.charge>0&&s.charge===0&&e.jsx("div",{className:t.free,children:"试读"})]})},s.id))})})]}),b===4&&e.jsx(Me,{bid:l,isBuy:a,comments:Z,commentUsers:ee,success:()=>{ie(),P()}})]})]})};export{Ye as default};
