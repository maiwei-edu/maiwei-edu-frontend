import{s as e,cA as z,p as n,v as W,J as he,K as pe,t as l,cB as X,u as ge,F as ve,G as je,S as j,a0 as Ae,I as H,D as q,z as ye,E as J}from"./index-bc9ff81c.js";import{u as Pe,d as be,q as Ke,b as Ne,v as we,e as qe,f as Ce,g as ke}from"./upload-e1e7de35.js";import{E as Se}from"./index-5aae9b85.js";import{U as Y}from"./index-0e49bc26.js";import{d as $}from"./default-avatar-e291781e.js";import{i as Oe}from"./icon-adopt-72bf1d26.js";import"./useForceUpdate-4c0917fe.js";const Ie=({url:f,close:h})=>e.jsx("div",{className:z["image-preview-shadow-box"],onClick:()=>h(),children:e.jsx("img",{className:z.img,src:f})}),Ve=({open:f,fresh:h,onUpdate:_})=>{const[p,r]=n.useState([]);W(i=>i.loginUser.value.user),n.useEffect(()=>{r([])},[h]);const C={name:"file",multiple:!1,method:"POST",action:he.app_url+"/addons/Wenda/api/v1/upload/image",headers:{Accept:"application/json",authorization:"Bearer "+pe()},beforeUpload:i=>{const c=i.type==="image/png"||i.type==="image/jpg"||i.type==="image/jpeg";c||l.error(`${i.name}不是图片文件`);const Z=i.size/1024/1024<2;Z||l.error("图片大小不超过2M");let K=!0;return p.length>=6&&(l.error("最多上传6张图片"),K=!1),c&&Z&&K||Y.LIST_IGNORE},onChange(i){const{status:c,response:Z}=i.file;if(c==="done")if(Z.code===0){l.success("上传成功");let K=Z.data.url,A=[...p];A.push(K),r(A),_(A)}else l.error(Z.msg);else c==="error"&&l.error(`${i.file.name} 上传失败`)}},u=i=>{let c=[...p];c.splice(i,1),r(c),_(c)};return e.jsx(e.Fragment,{children:f&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{...C,showUploadList:!1,children:e.jsx("div",{className:X["btn-upload-image"],children:e.jsx("img",{src:Pe})})}),p.length>0&&p.map((i,c)=>e.jsx("div",{className:X["img-item"],onClick:()=>u(c),children:e.jsx("img",{src:i})},c))]})})},Be="_credit_7o0qx_12",Ee="_title_7o0qx_22",We="_icon_7o0qx_29",Le="_tit_7o0qx_22",Ue="_stat_7o0qx_77",Fe="_line_7o0qx_113",Me="_avatar_7o0qx_127",Re="_nickname_7o0qx_232",Ge="_red_7o0qx_240",Qe="_diff_7o0qx_243",Te="_text_7o0qx_265",De="_thumbs_7o0qx_56",ze="_page_7o0qx_1",t={"question-body":"_question-body_7o0qx_1",credit:Be,title:Ee,icon:We,tit:Le,"question-content":"_question-content_7o0qx_48","thumbs-box":"_thumbs-box_7o0qx_56","thumb-item":"_thumb-item_7o0qx_63","image-view":"_image-view_7o0qx_70",stat:Ue,"comments-box":"_comments-box_7o0qx_93","comment-divider":"_comment-divider_7o0qx_104",line:Fe,"reply-box":"_reply-box_7o0qx_119",avatar:Me,"input-box":"_input-box_7o0qx_139","upload-body":"_upload-body_7o0qx_148","disabled-button":"_disabled-button_7o0qx_158","confirm-button":"_confirm-button_7o0qx_174","comments-list-box":"_comments-list-box_7o0qx_190","comment-item":"_comment-item_7o0qx_197","comment-content":"_comment-content_7o0qx_218","top-info":"_top-info_7o0qx_224",nickname:Re,red:Ge,diff:Qe,"correct-answer":"_correct-answer_7o0qx_250",text:Te,thumbs:De,"img-item":"_img-item_7o0qx_281","reply-answer-box":"_reply-answer-box_7o0qx_297","act-vote-button":"_act-vote-button_7o0qx_302","vote-button":"_vote-button_7o0qx_318","reply-answer":"_reply-answer_7o0qx_297","reply-trans-answer":"_reply-trans-answer_7o0qx_342","one-class-replybox":"_one-class-replybox_7o0qx_350","reply-list-box":"_reply-list-box_7o0qx_399","reply-list-item":"_reply-list-item_7o0qx_409","reply-avatar":"_reply-avatar_7o0qx_418","reply-content":"_reply-content_7o0qx_430","red-reply-nickname":"_red-reply-nickname_7o0qx_444","reply-nickname":"_reply-nickname_7o0qx_452","reply-diff":"_reply-diff_7o0qx_460","reply-text":"_reply-text_7o0qx_467","answer-item":"_answer-item_7o0qx_475","Two-class-replybox":"_Two-class-replybox_7o0qx_483",page:ze,"set-correct":"_set-correct_7o0qx_540"},Xe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAAXNSR0IArs4c6QAAAapQTFRFAAAAAP//AID/AKr/Var/QL//M5n/Sbb/Oar/M5n/M7P/LqL/QKr/Oar/NqHyQ67/QKb/ParzOqLzO6f1N6T2QK3/Pqf/O6r3OKf3Pqz/Oab5O6z/Pab5PKj6Paj/O6f6Pan7Pqn7O6n7PKn4O6b7Pqj7O6X8Paf8PKj4PKj8Pan5Paf5PKj5O6f8Paj5O6n8Oqf6PKf8Pqf8O6j6O6b6O6f6Paf6Paj6PKf6O6f6Paf6O6f7O6j7Paf7PKn7Paf5O6f5O6f7O6f7PKf5PKf7Paf7PKb6O6f6PKj7PKj6PKf6PKf6O6j6PKj6O6f6Paf6PKf6Paj6PKf6PKf6PKb5O6f6Paf6PKf7PKj7Paf7Paf7PKf7PKj7Paj7PKf7PKb6PKf6O6f6PKj7PKf6PKf7PKj7PKf6O6j7PKf6PKj7PKj6PKj7PKf7PKb6PKb6O6f6O6f6PKj6PKf6PKf7PKf7PKb5PKj7O6f6PKf7PKf7PKf6PKf7O6f6O6f7PKf6PKb6PKf6PKj6PKf6PKf7PKf6PKf7PKb6PKf6PKj7PKf6PKf7PKf6PKj7PKf6a2xerAAAAI10Uk5TAAECAwMEBQcJCgoLDBITExQVFhocHB0eICUoKy4vMjQ7PkFERUZKS0xMUFRVV1hfYGJjZGdoaGlucXF0eHp8goWFhoiIi42OkJWWmZuen6CipKWmp6iora+xtLa2ubq7vL2+v8LEyMrLy8zN0dLV19ve4uTl5ufo6u3u7vDw8fLz9fb29/f6+vv8/f7+OYBhpAAAAW1JREFUOMvV01dTE0AYRuGXUAKGomAEgdBU7KEplihNQUEFxN7ozWBHBUwklECi8fxnLhJIRmCzV8xwrnZ2n4tvd2alg6ny+c/I1w5XWncmDMD7I2mca5F4D9LARghfqXkJm24zfAiDkmsJWs3wNdyW9BT6zXAGrkrqhDdGlxOEc5LuwDsjvADRY5IG4InJOT/BqCSNwV2DyxyCf7WSHMvgc7uLHHu742+BIUnyJF49OFCWPM4/6/V6vRcvXXu8CvjzJKmd7UJ1267iGymNF0pS1nxyJ1CSgFMp7PetbEmS42i8E74I3EvAKHyfDsGvuRctBbvG7oIviSXg0SRc3/N+p2EjCU/uDxvghxXsgQkrOAz3reACNNnAYqDaBp6CP7k28AZ8lg18BM+soD/+g9LCrHU4bwPLgVIbeBkCsoAZIzCcCtvqPkJ31f/VvwKad+AKpuZydmCfyX0oSQ6S1xuKxWKxv7vV2uxNpw5NW9jH2lCCuL7+AAAAAElFTkSuQmCC",He="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAAXNSR0IArs4c6QAAAYNQTFRFAAAAAAAAgICAVVVVgICAZmZmbW1tVVVVZmZmXV1dampqY2NjXl5ea2trZmZmYWFhaGhoYmJiZGRkampqZmZmaGhoZ2dnZmZmZWVlZGRkZ2dnZmZmZ2dnaGhoZ2dnZmZmZWVlZ2dnZmZmZ2dnZmZmZWVlZmZmZGRkZmZmZ2dnZWVlZmZmZWVlZWVlZ2dnZmZmZmZmZWVlZ2dnZmZmZmZmZmZmZWVlZmZmZmZmZ2dnZmZmZmZmZ2dnZWVlZ2dnZ2dnZWVlZmZmZ2dnZ2dnZmZmZmZmZmZmZmZmZ2dnZmZmZmZmZ2dnZmZmZ2dnZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZWVlZmZmZmZmZWVlZmZmZWVlZ2dnZ2dnZmZmZmZmZmZmZ2dnZWVlZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZ2dnZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmGdHXeAAAAIB0Uk5TAAECAwQFBwkKCwwSExMUFRYaHB0eICUoKy4vMjQ7PkFERUZKS0xQVFVXWF9gYmNkZ2hoaW5xdHh6fIKFhoiIi42OkJWWmZuen6CipKWmp6itr7G0trm6u7y9vr/CxMjKy8vMzM3R0tXX297i5OXm5+jq7e7w8fLz9fb3+vv8/f53hBT1AAABZ0lEQVQ4y9XTV1PCQBQF4AiCYCd2LNh7V7Bg7yiKBbF37F0RpSjnp3uBQBjBzT4543m5O3u/7Gw2G0H4m5Q5HgM3Vr2iq/UjnBOdgtM/I5pZBdgO+Lsr14CAyIZzwCKt+wL0suEGMEhlBVhgwyOgh4oVcDKdxgM0UB0FNpmwEQjmUbUByyynvQS2w4MdYIzh1HYgVEUD1RtgEcUcVWonOumg7eGRUTp1j61IbmfWt1KamvuWPqh1Gvl0w4jFa4q50lskZDc7soU7eebVIMGDBOYZSI/MqXKjKbAEgEkJBoH7Qy896V7tykra9ghwLQ1pIaOwD/SnfL8auiMyLP4dtgEPXHAC2OOCLmCKCz4BHTwwn7oVPLAa+MzggWbgSuCB84CDC55F/yBFqPZFfwxFWELNQh7YQndF4IBpW4ArEQ6ZLoDx8p+pW6deZxy+gxW3Jg5nWO7cIG9EN+0NUb6Sle/YrBX+Tb4BMILG3GdM0CkAAAAASUVORK5CYII=",ms=()=>{const f=ge(),h=ve(),[_,p]=n.useState(!0),[r,C]=n.useState({}),[u,i]=n.useState([]),[c,Z]=n.useState(!1),[K,A]=n.useState(!1),[ee,L]=n.useState([]),[se,Je]=n.useState(!0),[te,k]=n.useState(!1),[ae,U]=n.useState(""),[y,F]=n.useState(""),[S,M]=n.useState([]),[x,N]=n.useState(""),[g,R]=n.useState([]),[Ye,ne]=n.useState(0),[$e,oe]=n.useState(0),[G,O]=n.useState([]),[re,es]=n.useState(1),[ie,ss]=n.useState(1e4);n.useState(0);const[I,ce]=n.useState(Number(h.courseId)),[P,v]=n.useState(!0),[Q,me]=n.useState(!1),b=W(s=>s.loginUser.value.user),V=W(s=>s.loginUser.value.isLogin);n.useEffect(()=>{B()},[I]),n.useEffect(()=>{ce(Number(h.courseId))},[h.courseId]),n.useEffect(()=>{je(document.getElementById("desc"))},[document.getElementById("desc")]);const B=()=>{be(I).then(s=>{document.title=s.data.question.title,C(s.data.question),i(s.data.answers),Z(s.data.is_admin),A(s.data.is_vote),p(!1),v(!1)})},le=()=>{P||y!==""&&(v(!0),Ne(I,{original_content:y,render_content:y,images:ee}).then(s=>{F(""),L([]),me(!Q),l.success("评论成功"),v(!1),B()}).catch(s=>{v(!1)}))},de=(s,a)=>{if(!V){T();return}s.user&&we({id:s.id,type:1}).then(o=>{let d=o.data.ok===1;if(A(d),s.is_vote===1){let m=[...u];m[a].vote_count--,m[a].is_vote=0,i(m),l.success("取消点赞")}else{let m=[...u];m[a].vote_count++,m[a].is_vote=1,i(m),l.success("已点赞")}})},ue=s=>{if(!V){T();return}let a=[];a[s]=!0,N(""),O(a),M([])},_e=(s,a)=>{if(a===0)return;let o=[];o[s]=!o[s],M(o),N(""),O([]),ne(a),qe(a,{page:re,page_size:ie}).then(d=>{let m=[...g];m[s]=d.data.data.data,R(m)})},Ze=(s,a,o,d)=>{if(!P){if(!o){l.error("回复的用户不存在");return}x&&(oe(s),v(!0),Ce(s,{original_content:x,render_content:x,reply_user_id:a}).then(m=>{O([]),l.success("回复成功");let E;a?E={id:m.data.comment_id,parent_id:s,render_content:x,children_count:0,reply_comment:{user:{nick_name:o}},created_at:"刚刚",user:{avatar:b.avatar,nick_name:b.nick_name}}:E={id:m.data.comment_id,parent_id:s,render_content:x,children_count:0,reply_comment:null,created_at:"刚刚",user:{avatar:b.avatar,nick_name:b.nick_name}};let w;g[d]?(w=g[d],w.unshift(E)):w=[];let D=[...g];D[d]=w,R(D);let fe=[...u];u[d].reply_count=u[d].reply_count+1,i(fe),N(""),v(!1)}).catch(m=>{v(!1)}))}},T=()=>{let s=encodeURIComponent(window.location.pathname+window.location.search);f("/login?redirect="+s)},xe=s=>{s.user&&ke(r.id,{answer_id:s.id}).then(()=>{l.success("成功"),B()})};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"bread-nav",children:[_&&e.jsx(j.Button,{active:!0,style:{width:1200,height:14,marginLeft:0}}),!_&&e.jsxs(e.Fragment,{children:[e.jsx("a",{onClick:()=>{f("/")},children:"首页"})," ","/",e.jsx("a",{onClick:()=>{f("/wenda")},children:"问答社区"})," ","/",e.jsx("span",{children:r.title})]})]}),te&&e.jsx(Ie,{url:ae,close:()=>k(!1)}),_&&e.jsxs("div",{className:t["question-body"],children:[e.jsx(j.Button,{active:!0,style:{width:1140,height:34,marginBottom:25}}),e.jsx(j.Button,{active:!0,style:{width:1140,height:26,marginBottom:30}}),e.jsx(j.Button,{active:!0,style:{width:1140,height:14}})]}),!_&&e.jsxs("div",{className:t["question-body"],children:[r.credit1>0&&e.jsxs("div",{className:t.credit,children:["悬赏：",r.credit1,"积分"]}),e.jsxs("div",{className:t.title,children:[e.jsx("div",{className:t.icon,children:e.jsx("img",{src:Ke})}),e.jsx("div",{className:t.tit,children:r.title})]}),e.jsx("div",{className:t["question-content"],children:e.jsx("div",{dangerouslySetInnerHTML:{__html:r.render_content}})}),r.images_list&&r.images_list.length>0&&e.jsx("div",{className:t["thumbs-box"],children:r.images_list.map((s,a)=>e.jsx("div",{className:t["thumb-item"],children:e.jsx("div",{className:t["image-view"],style:{backgroundImage:"url("+s+")"},onClick:()=>{U(s),k(!0)}})},a))}),e.jsxs("div",{className:t.stat,children:[e.jsx("span",{className:t.datetime,children:Ae(r.created_at)}),e.jsxs("span",{className:t["view-times"],children:[r.view_times,"次浏览"]}),e.jsxs("span",{className:t["answer-count"],children:[r.answer_count,"回答"]})]})]}),e.jsxs("div",{className:t["comments-box"],children:[!_&&V&&r.status!==1&&e.jsxs("div",{className:t["reply-box"],children:[b&&e.jsx("div",{className:t.avatar,children:e.jsx("img",{src:b.avatar})}),e.jsx(H,{className:t["input-box"],onChange:s=>{F(s.target.value)},value:y,placeholder:"此处填写你的回答"}),y===""&&e.jsx(q,{className:t["disabled-button"],children:"发布回答"}),y!==""&&e.jsx(q,{type:"primary",loading:P,className:t["confirm-button"],onClick:()=>le(),children:"发布回答"}),e.jsx("div",{className:t["upload-body"],children:e.jsx(Ve,{open:se,fresh:Q,onUpdate:s=>{L(s)}})})]}),e.jsx("div",{className:t["comment-divider"],children:"全部回答"}),e.jsx("div",{className:t.line}),e.jsxs("div",{className:t["comments-list-box"],children:[P&&e.jsx("div",{style:{width:1140,marginTop:50,display:"flex",flexDirection:"column"},children:Array.from({length:3}).map((s,a)=>e.jsxs("div",{style:{width:1140,height:48,marginBottom:30,display:"flex",flexDirection:"row"},children:[e.jsx(j.Avatar,{active:!0,size:48,style:{marginRight:30}}),e.jsxs("div",{style:{width:960,height:48,display:"flex",flexDirection:"column"},children:[e.jsx(j.Button,{active:!0,style:{width:960,height:14,marginTop:3,marginBottom:16}}),e.jsx(j.Button,{active:!0,style:{width:960,height:14}})]})]},a))}),!P&&u.length===0&&e.jsx(ye,{span:24,children:e.jsx(Se,{})}),!P&&u.length>0&&u.map((s,a)=>e.jsxs("div",{className:t["comment-item"],children:[e.jsxs("div",{className:t.avatar,children:[s.user&&e.jsx("img",{src:s.user.avatar}),!s.user&&e.jsx("img",{src:$})]}),e.jsxs("div",{className:t["comment-content"],children:[e.jsxs("div",{className:t["top-info"],children:[!s.user&&e.jsx("div",{className:t.nickname,children:"未知用户"}),s.user&&e.jsx("div",{className:t.nickname,children:s.user.nick_name}),e.jsx("div",{className:t.diff,children:J(s.created_at)}),s.is_correct===1&&e.jsxs("div",{className:t["correct-answer"],children:[e.jsx("img",{src:Oe}),"此回答已被题主采纳"]})]}),e.jsx("div",{className:t.text,id:"desc",dangerouslySetInnerHTML:{__html:s.render_content}}),s.images_list.length>0&&e.jsx("div",{className:t.thumbs,children:s.images_list.map((o,d)=>e.jsx("div",{className:t["img-item"],children:e.jsx("div",{className:t["image-view"],style:{backgroundImage:"url("+o+")"},onClick:()=>{U(o),k(!0)}})},d))}),e.jsxs("div",{className:t["reply-answer-box"],children:[e.jsxs("div",{className:s.is_vote===1?t["act-vote-button"]:t["vote-button"],onClick:()=>de(s,a),children:[s.is_vote===1&&e.jsx("img",{src:Xe}),s.is_vote!==1&&e.jsx("img",{src:He}),s.vote_count]}),s.reply_count!==0&&e.jsxs("div",{className:S[a]===!0?t["reply-trans-answer"]:t["reply-answer"],onClick:()=>_e(a,s.id),children:[s.reply_count,"回复"]}),s.reply_count===0&&s.user&&e.jsx("div",{className:G[a]===!0?t["reply-trans-answer"]:t["reply-answer"],onClick:()=>ue(a),children:"回复"})]}),(S[a]===!0||G[a]===!0)&&e.jsxs("div",{className:t["one-class-replybox"],children:[e.jsx(H,{className:t["input-box"],value:x,onChange:o=>{N(o.target.value)},placeholder:"回复"+s.user.nick_name}),x===""&&e.jsx(q,{className:t["disabled-button"],children:"发表回复"}),x!==""&&e.jsx(q,{type:"primary",className:t["confirm-button"],onClick:()=>Ze(s.id,0,s.user.nick_name,a),children:"发表回复"})]}),S[a]===!0&&e.jsx("div",{className:t["reply-list-box"],children:g.length>0&&g[a]&&g[a].map(o=>e.jsxs("div",{className:t["reply-list-item"],children:[e.jsxs("div",{className:t["reply-avatar"],children:[o.user&&e.jsx("img",{src:o.user.avatar}),!o.user&&e.jsx("img",{src:$})]}),e.jsxs("div",{className:t["reply-content"],children:[e.jsxs("div",{className:t["top-info"],children:[!o.user&&e.jsx("div",{className:t["red-reply-nickname"],children:"未知用户"}),o.user&&e.jsx("div",{className:t["reply-nickname"],children:e.jsxs(e.Fragment,{children:[o.user.nick_name,o.reply_user_id>0&&e.jsxs(e.Fragment,{children:["回复：",o.reply_user.nick_name]})]})}),e.jsx("div",{className:t["reply-diff"],children:J(o.created_at)})]}),e.jsx("div",{className:t["reply-text"],dangerouslySetInnerHTML:{__html:o.render_content}})]})]},o.id))}),r.status===0&&c&&s.user_id!==r.user_id&&e.jsx("div",{className:t["set-correct"],onClick:()=>xe(s),children:"采纳此回答"})]})]},s.id))]})]})]})})};export{ms as default};
